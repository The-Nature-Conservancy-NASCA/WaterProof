{% extends "geonode_base.html" %} {% load i18n %} {% block title %}{% trans "Water Intakes" %}{% endblock %} 
 
{% load i18n %} 
{% load static from staticfiles %}
{% load bootstrap_tags %} 
<h1>{% trans "Water Intakes" %}</h1>

{% block extra_head %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
    <link rel="stylesheet" href="{% static "geonode/css/leaflet/Control.Coordinates.css" %}"/>
    <link rel="stylesheet" href="https://photon.komoot.io/static/leaflet.photon/leaflet.photon.css"></link>

    <script>
        var intakePolygons=[]; 
        SEARCH_CITY_API_URL = '{{ SEARCH_CITY_API_URL }}';
        SEARCH_COUNTRY_API_URL = '{{ SEARCH_COUNTRY_API_URL }}';   
    </script>

<style>
    .side {
        height: 100%;
        background-image: url('/static/geonode/img/FONDO.jpg');
    }


    .flecha {
        padding-left: 0.5rem;
        height: 2rem;
    }

    #wrapper {
        padding-left: 0;
        -webkit-transition: all 0.5s ease;
        -moz-transition: all 0.5s ease;
        -o-transition: all 0.5s ease;
        transition: all 0.5s ease;
    }

    #wrapper.toggled {
        padding-left: 35rem;
    }

    #sidebar-wrapper {
        z-index: 1000;
        position: fixed;
        left: 35rem;
        width: 0;
        height: 100%;
        margin-left: -35rem;
        overflow-y: auto;
        -webkit-transition: all 0.5s ease;
        -moz-transition: all 0.5s ease;
        -o-transition: all 0.5s ease;
        transition: all 0.5s ease;
        overflow-x: hidden;
    }

    #wrapper.toggled #sidebar-wrapper {
        width: 35rem;
    }

    #page-content-wrapper {
        width: 100%;
        position: absolute;
        padding: 15px;
    }

    #wrapper.toggled #page-content-wrapper {
        position: absolute;
        margin-right: -250px;
    }

    /* Sidebar Styles */

    .sidebar-nav {
        position: absolute;
        top: 10rem;
        width: 35rem;
        margin: 0;
        padding: 0 2.5rem 0 0;
        list-style: none;
    }

    .sidebar-nav li {
        padding-left: 2.5rem;
        margin-bottom: 1rem;
        margin-top: 1rem;
    }

    .list-unstyled li a {
        background-color: rgba(52, 176, 204, 0.7) !important;
    }

    .sidebar-nav li a {
        display: flex;
        text-decoration: none;
        color: #fff;
        vertical-align: middle;
        align-items: center;
        background-color: rgba(58, 128, 154, 0.7);
        font-size: 20px;
        border-radius: 0.5rem;
        height: 6rem;
    }

    .sidebar-nav li a:hover {
        text-decoration: none;
        color: #fff;
        background: rgba(58, 128, 154, 0.7);
    }

    .sidebar-nav li a:active,
    .sidebar-nav li a:focus {
        text-decoration: none;
    }

    .sidebar-nav>.sidebar-brand {
        height: 65px;
        font-size: 18px;
        line-height: 60px;
    }

    .sidebar-nav>.sidebar-brand a {
        color: #999999;
    }

    .sidebar-nav>.sidebar-brand a:hover {
        color: #fff;
        background: none;
    }

    @media(min-width:768px) {
        #wrapper {
            padding-left: 35rem;
        }

        #wrapper.toggled {
            padding-left: 0;
        }

        #sidebar-wrapper {
            width: 35rem;
        }

        #wrapper.toggled #sidebar-wrapper {
            width: 0;
        }

        #page-content-wrapper {
            padding: 20px;
            position: relative;
        }

        #wrapper.toggled #page-content-wrapper {
            position: relative;
            margin-right: 0;
        }
    }
</style>

<!--Lateral Menu-->

<nav id="sidebar-wrapper" class="side">
  <div class="p-4 pt-5">
      <ul class="sidebar-nav">
        <li class="active">
          <a href="#Home" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">Home</a>
          <ul class="collapse list-unstyled" id="Home">
            <li><a href="#Users"data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              Users</a>
          <ul class="collapse list-unstyled" id="Users">
            <li><a href="#list">
                <img src="/static/geonode/img/01-flecha.png" class="flecha">
                User list</a></li>
                <li><a href="#Registry">
                    <img src="/static/geonode/img/01-flecha.png" class="flecha">
                    Registry</a></li>
        </ul>
                
            </li>
          </ul>
      </li>
      <li>
        <a href="#Nature" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
            <img src="/static/geonode/img/01-flecha.png" class="flecha">Nature Based-Solutions/ Conservations Activities</a>
      </li>
      
      {% if GEONODE_APPS_ENABLE and GEONODE_APPS_NAV_MENU_ENABLE %}
      <li class="active">
        {% if user.is_authenticated %}
          <a href="#Apps" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">Water intakes</a>
          <ul class="collapse list-unstyled" id="Apps">
            <li><a href="{% url "apps_browse" %}?limit={{ CLIENT_RESULTS_LIMIT }}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Explore" %} {% blocktrans %}{{GEONODE_APPS_NAME}}{% endblocktrans %}</a></li>
            <li><a href="{% url "search_city" %}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Search City" %} </a></li>
            <li><a href="{% url "list-nbs" %}?limit={{ CLIENT_RESULTS_LIMIT }}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "List SBN" %} </a></li>
            <li><a href="{% url "list-intake" %}?limit={{ CLIENT_RESULTS_LIMIT }}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "List Intakes" %} </a></li>
            <li><a href="{% url "treatment-plants-list" %}?limit={{ CLIENT_RESULTS_LIMIT }}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Treatment Plants List" %} </a></li>
          </ul>
          {% else %}
          <a href="{% url "apps_browse" %}?limit={{ CLIENT_RESULTS_LIMIT }}">
            <img src="/static/geonode/img/01-flecha.png" class="flecha">
            {% blocktrans %}{{GEONODE_APPS_NAME}}{% endblocktrans %}</a>
        {% endif %}
      </li>
      {% endif %}
      <li>
          
        {% if user.is_authenticated %}
          <a href="#Maps" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">Study cases
          </a>
          <ul class="collapse list-unstyled" id="#">
            <li><a href="{% url "maps_browse" %}?limit={{ CLIENT_RESULTS_LIMIT }}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Explore Maps" %}</a></li>
              {% if not READ_ONLY_MODE %}
              <li> <a href="{% url "new_map" %}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Create Map" %}</a></li>
            {% endif %}
          </ul>
          {% else %}
            <a href="{% url "maps_browse" %}?limit={{ CLIENT_RESULTS_LIMIT }}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Maps" %}</a>
          {% endif %}
      </li>
      <li>
          <a href="#About" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">Run Analysis</a>
          <ul class="collapse list-unstyled" id="About">
            <li><a href="{% url "profile_browse" %}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "People" %}</a></li>
            <li><a href="{% url "group_list" %}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Groups" %}</a></li>
            <li><a href="{% url "group_category_list" %}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Group Categories" %}</a></li>
            {% if perms.announcements.can_manage %}
              <li><a href="{% url "announcements_list" %}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Announcements" %}</a></li>
            {% endif %}
            {% if user.is_authenticated and not READ_ONLY_MODE %}
              <li role="separator" class="divider"></li>
              <li><a href="{% url "geonode.invitations:geonode-send-invite" %}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Invite Users" %}</a></li>
            {% endif %}
            {% if user.is_superuser and not READ_ONLY_MODE %}
              <li><a href="{% if SITEURL|default:""|slice:"-1:" == "/" %}{{SITEURL}}{% else %}{{SITEURL}}/{% endif %}admin/people/profile/add/">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Add User" %}</a></li>
              <li><a href="{% url "group_create" %}">
              <img src="/static/geonode/img/01-flecha.png" class="flecha">
              {% trans "Create Group" %}</a></li>
            {% endif %}
          </ul>
      </li>
      <li>
        <a href="#Results" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
            <img src="/static/geonode/img/01-flecha.png" class="flecha">Results</a>
      </li>
      </ul>
  </div>
</nav>
</div>
{% endblock %} {% block body_outer %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/dataTables.bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/waterproof_nbs_ca.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />
<div class="row">
    <div class="col-md-4">
        <h4 class="text-center" id="countryLabel">{{city.name}}</h4>
        <p><b>{% trans "Selected City" %} :</b> <span id="cityLabel"></span> </p>
        <p><b>{% trans "Region" %} :</b> <span id="regionLabel"></span> </p>
        <p><b>{% trans "Currency" %}:</b><span id="currencyLabel"></span></p>
    </div>
    <div class="col-md-8">
        <div id="mapidcuenca" style="width: 700px; height: 400px;"></div>

    </div>
</div>
<div class="page-header">
   
    <h1>{% trans "List Intakes" %}</h1>
    <h7>{% trans "Enter the name of the city of your interest in the 'Search city' space on the map and select the corresponding option from the list" %}</h7>
    <br>
    <br>
    <a href="create/" id="createUrl">{% trans "Create new Water Intake" %}</a>
</div>
<div class="table-responsive">
    <table id="example" class="table table-striped table-bordered table-condensed" style="width:100%">
        <thead>
            <tr class="info">
                <th scope="col" class="small text-center vat">{% trans "Name" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Description" %}</th>
                <th scope="col" class="small text-center vat">{% trans "User" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Creation Date" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Water source name" %}</th>
                <th scope="col" class="small text-center vat" >{% trans "City" %}</th>
                <th scope="col" class="small text-center vat" style="display: none;">{% trans "Region" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Demand" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Options" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for intake in intakeList %}
            <tr>
                <td class="small text-center vat">{{intake.name}}</td>
                <td class="small text-center vat">{{intake.description}}</td>
                <td class="small text-center vat">{{intake.added_by.first_name}} {{intake.added_by.last_name}}</td>
                <!--td>{{intake.max_benefit_req_time}}</td-->
                <td class="small text-center vat">{{intake.creation_date | date:"d-m-Y"}}</td>
                <td class="small text-center vat">{{intake.water_source_name}}</td>
                <td class="small text-center vat">{{intake.city.name}}</td>
                <td class="small text-center vat" style="display: none;">{{intake.area}}</td>
                <!--td>{{intake.total_profits_intake_consec_time}}</td-->
                <!--td class="small text-center vat">{{intake.creation_date}}</td>
                <!td class="small text-center vat">{{intake.unit_maintenance_cost|floatformat:2}}</td>
                <td class="small text-center vat">{{intake.periodicity_maitenance}}</td>
                <td class="small text-center vat">{{intake.unit_oportunity_cost|floatformat:2}}</td-->
                <!--td>{{intake.rios_transformations.description}}</td-->
                <td>
                    <div class="btn-group btn-group-table" role="group">
                        <a class="btn btn-primary" href="/intake/viewDemand/{{intake.pk}}"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></a>
                     </div> 
                </td>  
                <td>
                    <div class="btn-group btn-group-table" role="group">
                        <a class="btn btn-primary" href="/intake/view/{{intake.pk}}"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></a>
                        {% if user.is_authenticated %}
                            {% if user.professional_role == 'ADMIN' %}
                            <a class="btn btn-info" href="/intake/edit/{{intake.pk}}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                            <a class="btn btn-warning" href="/intake/clone/{{intake.pk}}"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></a>
                            <a class="btn btn-danger" data-id="{{intake.pk}}" ><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
                            {% endif %}
                            {% if user.professional_role == 'ANALYS' or user.professional_role == 'COPART' or user.professional_role == 'ACDMC' or user.professional_role == 'SCADM' or user.professional_role == 'MCOMC' or user.professional_role == 'CITIZN' or user.professional_role == 'REPECS' or user.professional_role == 'OTHER' %}
                                {% if intake.added_by.pk == user.pk %}
                                <a class="btn btn-info" href="/intake/edit/{{intake.pk}}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                                <a class="btn btn-warning" href="/intake/clone/{{intake.pk}}"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></a>
                                <a class="btn btn-danger" data-id="{{intake.pk}}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
                                {% else %}
                                <a class="btn btn-warning"  href="/intake/clone/{{intake.pk}}"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></a>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </div>
                       
                </td>
            </tr>
            <script>
                var intakeObject={};
                intakeObject.id='{{intake.id}}'
                intakeObject.polygon='{{intake.polygon_set.first.geom}}';
                intakeObject.city = '{{intake.city.name}}';
                intakePolygons.push(intakeObject);
                /*var intake = {};
                intake.id = '{{intake.id}}';
                intake.city = '{{intake.city.name}}';*/

            </script>
            {% endfor %}
        </tbody>
    </table>
</div>

{% block body %}{% endblock body %} {% block sidebar %}{% endblock sidebar %} {% endblock body_outer %} {% block extra_script %}
<script>
    var countriesLayerUrl = '{{ STATIC_URL }}waterproof_intake/data/countries.geojson';
    var userCountryId='{{userCountry.id}}';
    var userCountryCode='{{userCountry.code}}';
    var userCountryName='{{userCountry.name}}';
    var intakeList='{{intakeList}}';
</script>
<script src="{{ STATIC_URL }}geonode/js/datatables/jquery.dataTables.min.js"></script>
<script src="{{ STATIC_URL }}geonode/js/datatables/dataTables.bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/leaflet.ajax.min.js"></script>
<script src="{{ STATIC_URL }}waterproof_intake/js/intake_list.js"></script>
<script src="https://vinceg.github.io/twitter-bootstrap-wizard/jquery.bootstrap.wizard.js"></script>
  <script src="https://vinceg.github.io/twitter-bootstrap-wizard/prettify.js"></script>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
  <script src="{{ STATIC_URL }}geonode/js/leaflet/photon/leaflet.photon.js"></script>
  <script src="{{ STATIC_URL }}geonode/js/leaflet/Leaflet.Coordinates.js" %}"></script>
  <script src="{{ STATIC_URL }}geonode/js/leaflet/leaflet-omnivore.min.js"></script>

  <script src="{{ STATIC_URL }}geonode/sample_data/intake_polygon.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script type="text/javascript">
    API_URL = '/proxy/?url=https://photon.komoot.de/api/?';
    TILELAYER = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png';
    CENTER = [-74.4879, 4.582];
    MAXZOOM = 11;

    let waterproof = {};

    $(document).ready(function () {
        
        
      
    });    

    var searchPoints = L.geoJson(null, {
        onEachFeature: function (feature, layer) {
            layer.bindPopup(feature.properties.name);
        }
    });
    
  </script>  
{% endblock %}