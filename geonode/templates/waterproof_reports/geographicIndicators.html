{% extends "menu.html" %} 
{% load i18n %} 
{% load static from staticfiles %} 
{% load bootstrap_tags %} 
{% block extra_head %}
<link href="https://unpkg.com/smartwizard@5/dist/css/smart_wizard_all.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="{{ STATIC_URL }}lib/css/leaflet.css"/>
<link rel="stylesheet" href="{% static "geonode/css/leaflet/leaflet.defaultextent.css" %}"/>
<link rel="stylesheet" href="{{ STATIC_URL }}geonode/css/leaflet/Control.Coordinates.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}geonode/css/leaflet/Control.Loader.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}waterproof_reports/css/reports.css" />

<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/dataTables.bootstrap.min.css">
<!-- <link rel="stylesheet" href="{% static "geonode/css/sidenav.css" %}"/> -->
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/waterproof_nbs_ca.css">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />


{% endblock %} {% block body_outer %}
<!--header--> 
<script type="text/javascript">
	var SelectedCurrency = "{{SelectedCurrency}}";
</script>
<div class="page-header" style="margin-bottom: 0px;height: 50px;margin-top: 0px;">
	<h1 class="title-financial">{% trans "Geographic visualization" %}</h1>
</div>
<br>
<!--Begin Form-->
<form id="form" method="POST" action="">
	{% csrf_token %}
	<!--Start smartwizard-->
	<div class="smart-wizard-financial">
		<div class="help-in-report header-desc-fin">
			{% trans "This report summarizes the Maps Reports... Lorep Ipsum ..." %}
		</div>
		<div class="align-menu-header">
			<div class="icons-menu-header">
				<a href="../../reports/financial/"><img src="/static/geonode/img/Indicadores-financieros.png" alt="financial indicators" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Financial indicators" %}"/></a>
				<br> 
				<a href="../../reports/financial/">{% trans "Financial indicators" %}</a>
			</div>
			<div class="icons-menu-header" id="idFinancialIndicators">
				<a id="urlPhysical" href=""><img src="/static/geonode/img/indicadores-fisicos.png" alt="physical indicators" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Physical indicators" %}"/> </a>
                <br> 
                <a id="urlPhysical" href="">{% trans "Physical indicators" %}</a>
			</div>
			<div class="icons-menu-header" id="idDecisionIndicators">
				<a href="../../reports/decision/"><img src="/static/geonode/img/indicadores-decision.png" alt="decision indicators" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Decision indicators" %}"/></a>
				<br>
				<a href="../../reports/decision/">{% trans "Decision indicators" %}</a>
			</div>
			<div class="icons-menu-header" id="idGeographicIndicators">
				<img src="/static/geonode/img/indicadores-geograficos.png" alt="geographic indicators" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black; opacity: 30%;" title="{% trans "Geographic visualization" %}"/>
				<br>
				<a>{% trans "Geographic visualization" %}</a>
			</div>
			<div class="icons-menu-header" id="idGeographicIndicators">
				<a id="Return" href=""><img src="/static/geonode/img/reportes-icon.png" alt="menu" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Geographic visualization" %}"/></a>
				<br>
				<a id="Return"></a>
			</div>
		</div>
	</div>
	<div id="smartwizard" style="position: relative;">
		<div class="border-table-title">
			<div class="title-table" id="idNameStudyCase">{% trans "Study Case" %}</div>
			<div class="detail-table">
				<div class="column-left-table">
					<div class="file-column-left">
						<div>{% trans "City:" %}</div>
						<div class="value-file-column-left" id="idCity">{% trans "-" %}</div>
					</div>
					<div class="file-column-left">
						<div>{% trans "Country:" %}</div>
						<div class="value-file-column-left" id="idCountri">{% trans "-" %}</div>
					</div>
					<div class="file-column-left">
						<div>{% trans "Region:" %}</div>
						<div class="value-file-column-left" id="idRegion">{% trans "-" %}</div>
					</div>
					<div class="file-column-left">
						<div>{% trans "Time frame (year):" %}</div>
						<div class="value-file-column-left" id="idTimeMainGeographic">{% trans "-" %}</div>
					</div>
				</div>
				<div class="column-right-table">
					<div class="file-column-left">
						<div class="title-file-column-right">{% trans "Number of water intakes that are part of the analysis:" %}</div>
						<div class="value-file-column-left" id="idNumberOfWaterGeographic"></div>
					</div>
					<div class="file-column-left">
						<div class="title-file-column-right">{% trans "Number of drinking water treatment plants in the system:" %}</div>
						<div class="value-file-column-left" id="idNumberOfDrinkingGeographic"></div>
					</div>
					<div class="file-column-left">
						<div class="title-file-column-right">{% trans "currency:" %}</div>
						<div class="value-file-column-left" id="idCurrencyMainGeographic">{% trans "-" %}</div>
					</div>
					<div class="file-column-left">
						<div class="title-file-column-right">{% trans "discount rate:" %}</div>
						<div class="value-file-column-left" id="discountRateGeographic">{% trans "-" %}</div>
					</div>
				</div>
			</div>
		</div>

		<div>
			<h5>{% trans "Water Intake" %}: 
				<select class="select-condition" style="width: 800px; text-align: center;" id="idSelectStudyCase"></select>
			</h5>
		</div>
		<div class="modal-body-li">
			<ul class="nav nav-pills padding-nav" id="myTab" role="tablist">
				<li id="first_tab" class="nav-item active"><a class="radius-button-list nav-link active" data-toggle="tab" href="#menu1">{% trans "Land cover comparision" %}</a></li>
				<li class="nav-item"><a class="radius-button-list nav-link" data-toggle="tab" href="#menu2">{% trans "Physical changes" %}</a></li>
				<li class="nav-item"><a class="radius-button-list nav-link" data-toggle="tab" href="#menu3">{% trans "NbS portfolio" %}</a></li>
			</ul>
				<div class="tab-content" id="myTabContent">
					<div id="menu1" class="div-style-menu-23 tab-pane fade active in" role="tabpanel">
						<h3 id="nameTitleIntake"></h3>
						{% for name in NamesIndicators %}
						<h5>{% trans "Water Intake" %}: {{name.name}} </h5>
						{% endfor %}
						<p class="padding-text-desc">{% trans "LULC_text_1" %}</p>
						<p class="padding-text-desc">{% trans "LULC_text_2" %}</p>
						<br>
						<div class="row padding-text-desc">        
							<div class="col-md-6">
								<p>{% trans "LULC_text_3" %}</p>
								<div id="map-left" class="map__compare"></div>
							</div>
							<div class="col-md-6">
								<p>{% trans "LULC_text_4" %}</p>
								<div id="map-right" class="map__compare"></div>
							</div>
						</div>
						<div>-----</div>
						<div id="map-3" class="row padding-text-desc">
							<div class="col-md-6">
								<p>{% trans "LULC_text_5" %}</p>
								<div id="map-down" class="map__compare"></div>
							</div>
							<div class="col-md-6">
								<div id="legend-left" class="legend__compare">
									<img src="" alt="legend" id="img-legend-left"/>
								</div>
							</div>
						</div>						
					</div>
					<div id="menu2" class="div-style-menu-23 tab-pane fade" role="tabpanel">
						<h3 id="nameTitleIntake"></h3>
						{% for name in NamesIndicators %}
						<h5>{% trans "Water Intake" %}: {{name.name}} </h5>
						{% endfor %}
						<p class="padding-text-desc">{% trans "InVEST text 1" %}</p>
						<p class="padding-text-desc">{% trans "InVEST text 2" %}</p>
					</div>
					<div id="menu3" class="div-style-menu-23 tab-pane fade" role="tabpanel">
						<h3 id="nameTitleIntake"></h3> 
						{% for name in NamesIndicators %}
						<h5>{% trans "Water Intake" %}: {{name.name}} </h5>
						{% endfor %}
						<p class="padding-text-desc">{% trans "RIOS text 1" %}</p>
					</div>
					<div id="map-analysis-result" class="row">
						<div class="col-md-12 padding-text-desc">
							<div id="map-results" class="map__compare"></div>
						</div>        
					</div>
					<div id="map-areas-rios-container" class="row">
						<div class="col-md-9 padding-text-desc">
							<div id="map-areas-rios" class="map__compare"></div>
						</div>        
						<div class="col-md-3">
							<div id="map-areas-rios-legend"></div>
							<img src="" alt="legend" id="img-legend-areas-rios"/>
						</div>    
						<div class="col-md-12">
							<div>
								<h5 textColor="red" class="download-title-geographic">{% trans "If you want to download the results of this analysis from the following icons" %}</h5>
							</div>
							<div class="report-download" style="display: block;">
								<div class="col-md-5"></div>
								<div class="col-md-1 report-download-pdf" onclick="openPDF()">
									<img src="/static/geonode/img/documents.png" alt="documents"/>
									<br>
									PDF
								</div>
							</div>
						</div>    
					</div>
				</div>         
				<img id="resultado" style="visibility:hidden" alt="result">
				<form id="TheForm" method="post" action="../../reports/pdf/" target="TheWindow">
					{% csrf_token %}
					<input type="hidden" name="studyCase" id="studyCase"/>
					<input type="hidden" name="studyCity" id="studyCity"/>
					<input type="hidden" name="studyCountry" id="studyCountry"/>
					<input type="hidden" name="studyRegion" id="studyRegion"/>
					<input type="hidden" name="discountRateData" id="discountRateData"/>
					<input type="hidden" name="mapSendImage" id="mapSendImage"/>
				</form>   
		</div>
		<img src="" alt="legend" id="generated-img"/>

		<div class="align-text col-md-12 div-padding visible">
			<div class="list-menu-results" id="idFinancialIndicators">
				<a href="../../reports/financial/"><img src="/static/geonode/img/Indicadores-financieros.png" alt="financial indicators" title="{% trans "Financial indicators" %}"/></a>
				<br> 
				<a href="../../reports/financial/">{% trans "Financial indicators" %}</a>
			</div>
			<div class="list-menu-results">
				<a id="urlPhysical" href=""><img src="/static/geonode/img/indicadores-fisicos.png" alt="physical indicators" title="{% trans "Physical indicators" %}"/></a>
				<br>
				<!--a>{% trans "Physical indicators" %}</a-->
				<a id="urlPhysical" href="">{% trans "Physical indicators" %}</a>
			</div>
			<div class="list-menu-results" id="idDecisionIndicators">
				<a href="../../reports/decision/"><img src="/static/geonode/img/indicadores-decision.png" alt="decision indicators" title="{% trans "Decision indicators" %}"/></a>
				<br>
				<a href="../../reports/decision/">{% trans "Decision indicators" %}</a>
			</div>
			<div class="list-menu-results" id="idGeographicIndicators">
				<img src="/static/geonode/img/indicadores-geograficos.png" alt="geographic indicators" style="opacity: 30%;" title="{% trans "Geographic visualization" %}"/>
				<br>
				<a>{% trans "Geographic visualization" %}</a>
			</div>
		</div>
</form>

{% endblock %} {% block extra_script %}

<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
<script src="{% static "lib/js/leaflet.js" %}"></script>
<script src="{% static "geonode/js/leaflet/leaflet.defaultextent.js" %}"></script>
<script src=" {{ STATIC_URL }}geonode/js/leaflet/L.Map.Sync.js"></script>
<script src="{{ STATIC_URL }}waterproof_reports/js/reports_maps.js"></script>
<script src="{{ STATIC_URL }}geonode/js/waterproof/dom-to-image.min.js"></script>

<script type="text/javascript">

	OSM_BASEMAP_URL = '{{ OSM_BASEMAP_URL }} ';
	IMG_BASEMAP_URL = '{{ IMG_BASEMAP_URL }} ';    
	GRAY_BASEMAP_URL = '{{ GRAY_BASEMAP_URL }} ';
	GEOSERVER_WMS = '{{ GEOSERVER_WMS }}';
	const baseData = '{{ base_data }}';
  const intake = '{{ intake }}';
  const region = '{{ region }}';
  const year = '{{ year }}';
	const studyCaseId = '{{ study_case_id }}';
	let center = [4, -74];
  center = [{{ center}}];
	var serverApi = '{{serverApi}}';
	var lang = '{{LANGUAGE_CODE}}';	
	var countriesLayerUrl = '{{ STATIC_URL }}waterproof_nbs_ca/data/countries.geojson';
	var userCountryId='{{country.id}}';
	var userCountryCode='{{country.codeCountry}}';
	var userCountryName='{{country.nameCountry}}';
	let server = location.protocol + '//' + location.hostname.replace('apps','dev') + '/srv/';
  //server = 'https://dev.skaphe.com/srv/'; //'/srv/';  
  const urlWaterProofLyrsWMS = server + `?map=/etc/mapserver/mapserver_test.map&SERVICE=WMS&usr_folder=${baseData}&intake=${intake}&year=${year}&region=${region}`;
	const urlWaterProofLyrAreasRiosMS = server + `?map=/etc/mapserver/${baseData}/WI_${intake}/out/areas_rios.map&SERVICE=WMS`;
	var mapAreasRios;

	$(function () {		
		changeReport = function() {
				location.href = "../../study_cases/report/" + localStorage.idStudyCase;
		}

		var localStorageId = localStorage.idStudyCase;
		$('#Return').append(        `
				<a href="../../study_cases/report/${localStorageId}">{% trans "Return" %}</a>            
				`
		);   
			
		initialize = function () {

				$("#idCountri").html(localStorage.getItem('country'));
				$("#idCity").html(localStorage.getItem('city'));
				$("#idRegion").html(localStorage.getItem('region'));
				$("#idNameStudyCase").html(localStorage.getItem('studyCasesName'));        

				document.getElementById("idNumberOfWaterGeographic").innerHTML = localStorage.getItem('idNumberOfWater');
				document.getElementById("idNumberOfDrinkingGeographic").innerHTML = localStorage.getItem('idNumberOfDrinking');
				document.getElementById("idCurrencyMainGeographic").innerHTML = localStorage.getItem('idCurrencyMain');
				document.getElementById("idTimeMainGeographic").innerHTML = localStorage.getItem('idTimeMain');
				document.getElementById("discountRateGeographic").innerHTML = localStorage.getItem('transactionCost');
				let urlPhysicalIndicators = "../../reports/physical/"+localStorage.idStudyCase;
				document.getElementById("urlPhysical").href = urlPhysicalIndicators;
			};
		initialize();

		generateMap2Img = function (mapId, imgId) {
			var mapElement = document.getElementById(mapId);
			//const dataURL = await domtoimage.toPng(mapElement, { width, height })
			//const blob = await domtoimage.toBlob(mapElement, { width, height })
			$(".leaflet-control").hide();
			domtoimage.toPng(mapElement)
				.then(function (dataUrl) {
						$('#'+ imgId).attr('src', dataUrl);							
						$(".leaflet-control").show();
				})
				.catch(function (error) {
						console.error('oops, something went wrong!', error);
						$(".leaflet-control").show();
				});
		};
	});
    
</script>
{% endblock %}