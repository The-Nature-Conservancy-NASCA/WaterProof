{% extends "menu.html" %} {% load i18n %} {% load static from staticfiles %} {% load bootstrap_tags %} {% block extra_head %}
<link href="https://unpkg.com/smartwizard@5/dist/css/smart_wizard_all.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
<link rel="stylesheet" href="{{ STATIC_URL }}geonode/css/leaflet/Control.Coordinates.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}geonode/css/leaflet/Control.Loader.css" />
<!--
<link rel="stylesheet" href="{{ STATIC_URL }}waterproof_intake/mathquill/mathquill.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}waterproof_intake/css/intake.css" /> 
-->
<link rel="stylesheet" href="{{ STATIC_URL }}waterproof_reports/css/reports.css" />


{% endblock %} {% block body_outer %}
<!--header-->
<script type="text/javascript">
    var SelectedCurrency = "{{SelectedCurrency}}";
</script>
<div class="page-header" style="margin-bottom: 0px;height: 50px;margin-top: 0px;">
    <h1 class="title-financial">{% trans "Decision Indicators" %}</h1>
</div>
<br>
<!--Begin Form-->
<form id="form" method="POST" action="">
    {% csrf_token %}
    <!--Start smartwizard-->
    <div class="smart-wizard-financial">
        <div class="help-in-report header-desc-fin">
            {% trans "This report summarizes the proportions in investment and benefits that will be achieved by the implementation of the SbN:" %}
        </div>
        <div class="align-menu-header">
            <div class="icons-menu-header">
                <img src="/static/geonode/img/Indicadores-financieros.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Financial indicators" %}"/> 
                <br> 
                <a href="../../reports/financial/">{% trans "Financial indicators" %}</a>
            </div>
            <div class="icons-menu-header" id="idFinancialIndicators">
                <img src="/static/geonode/img/indicadores-fisicos.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black; opacity: 30%;" title="{% trans "Physical indicators" %}"/> 
                <br> 
                <a>{% trans "Physical indicators" %}</a>
                <!--<a href="../../reports/physical/">{% trans "Physical indicators" %}</a>-->
            </div>
            <div class="icons-menu-header" id="idDecisionIndicators">
                <img src="/static/geonode/img/indicadores-decision.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black; opacity: 30%;" title="{% trans "Decision indicators" %}"/>
                <br>
                <a>{% trans "Decision indicators" %}</a>
            </div>
            <div class="icons-menu-header" id="idGeographicIndicators">
                <img src="/static/geonode/img/indicadores-geograficos.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Geographic visualization" %}"/>
                <br>
                <a href="../../reports/geographic/">{% trans "Geographic visualization" %}</a>
            </div>
            <div class="icons-menu-header" id="idGeographicIndicators">
                <img src="/static/geonode/img/reportes-icon.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Geographic visualization" %}"/>
                <br>
                <a id="Return"></a>
            </div>
        </div>
    </div>
    <div id="smartwizard" style="position: relative;">
        <div class="border-table-title">
            <div class="title-table" id="idNameStudyCase">{% trans "Study Case" %}</div>
            <div class="detail-table">
                <div class="column-left-table">
                    <div class="file-column-left">
                        <div>{% trans "City:" %}</div>
                        <div class="value-file-column-left" id="idCity">{% trans "-" %}</div>
                    </div>
                    <div class="file-column-left">
                        <div>{% trans "Country:" %}</div>
                        <div class="value-file-column-left" id="idCountri">{% trans "-" %}</div>
                    </div>
                    <div class="file-column-left">
                        <div>{% trans "Region:" %}</div>
                        <div class="value-file-column-left" id="idRegion">{% trans "-" %}</div>
                    </div>
                    <div class="file-column-left">
                        <div>{% trans "Time frame (years):" %}</div>
                        <div class="value-file-column-left" id="idTimeMainDecision">{% trans "-" %}</div>
                    </div>
                </div>
                <div class="column-right-table">
                    <div class="file-column-left">
                        <div class="title-file-column-right">{% trans "Number of water intakes that are part of the analysis:" %}</div>
                        <div class="value-file-column-left" id="idNumberOfWaterDecision"></div>
                    </div>
                    <div class="file-column-left">
                        <div class="title-file-column-right">{% trans "Number of drinking water treatment plants in the system:" %}</div>
                        <div class="value-file-column-left" id="idNumberOfDrinkingDecision"></div>
                    </div>
                    <div class="file-column-left">
                        <div class="title-file-column-right">{% trans "Currency:" %}</div>
                        <div class="value-file-column-left" id="idCurrencyMainDecision">{% trans "-" %}</div>
                    </div>
                </div>
            </div>
        </div>
        <!--panel of navigation-->
        <!-- <div class="title-inform">
            <div id="idSectionIbc" class="inform-section">{% trans "Incidence of benefits and cost" %}</div>
            <div id="idSectionPe" class="inform-section inform-section-free">{% trans "Portfolio Efficiency" %}</div>
            <div id="idSectionOr" class="inform-section inform-section-free">{% trans "Oportunity result" %}</div>
            <div id="idSectionPr" class="inform-section inform-section-free">{% trans "Physical and risk indicator" %}</div>
            <div id="idSectionRi" class="inform-section inform-section-free">{% trans "Result of interventions" %}</div>
        </div> -->

        <div class="modal-body-li">
            <ul class="nav nav-pills padding-nav" id="myTab" role="tablist">
                <li class="nav-item active">
                    <a class="radius-button-list nav-link active" data-toggle="tab" href="#step1" role="tab" aria-controls="home" aria-selected="true">
                        {% trans "Incidence of benefits and cost" %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="radius-button-list nav-link"  data-toggle="tab" href="#step2" role="tab" aria-controls="profile" aria-selected="false">
                        {% trans "Portfolio Efficiency" %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="radius-button-list nav-link" id="mapInit" data-toggle="tab" href="#step3" role="tab" aria-controls="contact" aria-selected="false">
                        {% trans "Oportunity result" %}
                    </a>
                </li>
                <!-- <li class="nav-item">
                    <a class="radius-button-list nav-link"  data-toggle="tab" href="#step4" role="tab" aria-controls="contact" aria-selected="false">
                        {% trans "Physical and risk indicator" %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="radius-button-list nav-link" data-toggle="tab" href="#step5" role="tab" aria-controls="contact" aria-selected="false">
                        {% trans "Result of interventions" %}
                    </a>
                </li> -->
            </ul>

            <div class="tab-content" id="myTabContent">
                <div class="div-style-menu tab-pane fade active in" id="step1" role="tabpanel" aria-labelledby="overview-tab">
                    <br>
                    <p class="padding-text-desc">{% trans "Benefits and cost ind text 1" %}</p>
                    <div class="row">
                        <div class="contain-detail padding-text-desc-table col-md-12">
                            <!--Graph-->
                            <div class="col-md-6">
                                <select class="select-condition" id="idListSelectIntake" onchange="changePie(this.value)"></select>
                                <div id="containerAbi"></div>
                                <p>{% trans "Benefits and cost ind text 4" %}</p>
                            </div>
                            <div class="col-md-6">
                                <div id="containerAbt"></div>
                                <p>{% trans "Benefits and cost ind text 5" %}</p>
                            </div>
                        </div>
                    </div>                
                    <br>
                    <br>
                    <br>
                    <!--Table-->
                    <div class="row">
                        <div class="contain-detail padding-text-desc-table col-md-12">
                            <!--Graph-->
                            <div class="col-md-6">
                                <div id="containerAct"></div>
                                <p>{% trans "Benefits and cost ind text 2" %}</p>
                            </div>
                            <div class="col-md-6">
                                <div id="containerAca"></div>
                                <p>{% trans "Benefits and cost ind text 3" %}</p>
                            </div>
                        </div>
                    </div> 
                </div>
                <div class="div-style-menu tab-pane fade" id="step2" role="tabpanel" aria-labelledby="contact-tab">
                    <br>
                    <p class="padding-text-desc">{% trans "Portfolio efficiency ind text 1" %}</p>
                    <div class="col-md-12">
                            <div class="content-image col-md-4">
                                <img src="/static/geonode/img/eficiencia-de-portafolio.png"/>
                            </div>
                            <div class="contain-detail col-md-8">
                                <div class="first-detail-2">
                                    <!--Graph-->
                                <div id="containerPe"></div>
                                </div>
                            </div>
                    </div>                
                    <br>
                    <!--Table-->
                    <div style="clear:both;" class="table-responsive padding-text-desc-table">
                        <table id="idTablePe" class="table table-striped table-bordered table-condensed" style=" width:100%">
                            <thead>
                                <tr class="info">
                                    <th scope="col" class="small text-center vat">{% trans "Indicator" %}</th>
                                    <th scope="col" class="small text-center vat">{% trans "Change in volume of water yield (%)" %}</th>
                                    <th scope="col" class="small text-center vat">{% trans "Change in base flow (%)" %}</th>
                                    <th scope="col" class="small text-center vat">{% trans "Change in total sediments (%)" %}</th>
                                    <th scope="col" class="small text-center vat">{% trans "Change in nitrogen load (%)" %}</th>
                                    <th scope="col" class="small text-center vat">{% trans "Change in phosphorus load (%)" %}</th>
                                    <th scope="col" class="small text-center vat">{% trans "Change in carbon storage (%)" %}</th>
                                </tr>
                            </thead>
                            <tbody id="idTbodyEfficiency"></tbody>
                        </table>
                    </div>
                </div>
                <div class="div-style-menu-23 tab-pane fade" id="step3" role="tabpanel" aria-labelledby="how-tab">
                    <br>
                    <p class="padding-text-desc">{% trans "Oportunity results ind text 1" %}</p>
                    <div class="container-page">
                        <div id="step3-map">

                        </div>

                        <div class="row">
                            <div class="col-md-12 calculed-roi padding-text-desc-table">
                                <div class="col-md-12 line-detail">
                                    <div class="name-roi">{% trans "Calculated ROI:" %} <div class="value-roi" id="idRoi"></div></div>
                                        <img class="col-md-12 aria-img" src="/static/geonode/img/valor-bruto.png"/>
                                        <div class=" col-md-12 bootom-roi">
                                        <div>{% trans "ROI on nature based solutions opportunity" %}</div>
                                        <div class=" col-md-12 buttom-roi" id="idBtnRoi">Define</div>
                                    </div>
                                </div>
                                <div class=" col-md-12">
                                    <div class="line-detail">
                                        <div>{% trans "Total estimated investment" %}</div>
                                        <div class="value-line-detail" id="idTotalEstimatedInvestment"></div>
                                        <div>{% trans "Total treatment cost savings" %}</div>
                                        <div class="value-line-detail" id="idTotalTreatmentCostSavings"></div>
                                    </div>
                                    <div class="line-detail">
                                        <div>{% trans "Total area investment size (Ha)" %}</div>
                                        <div class="value-line-detail" id="idTotalAreaInvestmentSize"></div>
                                        <div>{% trans "Time frame (Years)" %}</div>
                                        <div class="value-line-detail" id="idTimeFrame"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- <div class="container-detail">
                            <div class="margin-detail">
                                <div class="margin-title">
                                    <div class="name-roi">{% trans "Calculated ROI:" %} <div class="value-roi" id="idRoi"></div></div>
                                        <img src="/static/geonode/img/valor-bruto.png" class="img-roi" />
                                        <div class="bootom-roi">
                                        <div>{% trans "ROI on nature based solutions opportunity" %}</div>
                                        <div class="buttom-roi" id="idBtnRoi">Define</div>
                                    </div>
                                </div>
                                <div class="container-detail-line">
                                    <div class="line-detail">
                                        <div>{% trans "Total estimated investment" %}</div>
                                        <div class="value-line-detail" id="idTotalEstimatedInvestment"></div>
                                        <div>{% trans "Total treatment cost savings" %}</div>
                                        <div class="value-line-detail" id="idTotalTreatmentCostSavings"></div>
                                    </div>
                                    <div class="line-detail">
                                        <div>{% trans "Total area investment size (Ha)" %}</div>
                                        <div class="value-line-detail" id="idTotalAreaInvestmentSize"></div>
                                        <div>{% trans "Time frame (Years)" %}</div>
                                        <div class="value-line-detail" id="idTimeFrame"></div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </div>
                <!-- <div class="tab-pane fade" id="step4" role="tabpanel" aria-labelledby="contact-tab">
                    <div style="text-align: center;width: 100%;position: relative;height: 400px;">
                        <div id="mapidphysical" style="position: relative;width: 100% ;height: 400px;"></div>
                    </div>                
                    <br>
                    <div class="title-water">{% trans "Water Intake" %} <span class="name-title-water">"{% trans "Water Intake" %}"</span></div>
                    <div class="margin-select">
                        <select class="select-condition" id="idSelectWaterIntake" onchange="loadGraphIntahe(this.value)">
                            <option></option>
                        </select>
                    </div>
                    <div id="idListGraph"></div>
                </div>
                <div class="tab-pane fade" id="step5" role="tabpanel" aria-labelledby="contact-tab">
                    <div>
                        <div class="content-icon-inter">
                            <div class="center-icon-inter">
                                <img src="/static/geonode/img/01-conservacion.png" class="img-icon-inter">
                            </div>
                        </div>
                        <div class="margin-detail-title-inter">
                            <div class="text-detail-title-inter">{% trans "Size recomended intervetion as a percent to total area" %}</div>
                            <div class="value-detail-title-inter" id="idSizeRecomend"></div>
                            <div class="line-detail-title-inter"></div>
                        </div>
                    </div>
                    <div>
                        <div class="cont-filter-inter">
                            <div class="name-filtar-inter">{% trans "Intervetion" %}</div>
                            <div>
                                <select class="select-condition" id="idSelectNameIntake"></select>
                            </div>    
                        </div>
                        <div class="title-inform-title">{% trans "Watershed information" %}</div>
                        <div>
                            <div class="total-inform-title">{% trans "Total size:" %}</div>
                            <div id="idTotalSizeWater"></div>
                        </div>
                    </div>
                    <div style="clear:both;" class="table-responsive">
                        <table id="idTablePe" class="table table-striped table-bordered table-condensed" style=" width:100%">
                            <thead>
                                <tr class="info">
                                    <th scope="col" class="small text-center vat">{% trans "Green infraestructure activity" %}</th>
                                    <th scope="col" class="small text-center vat">{% trans "Cost per hectare (USD)" %}</th>
                                    <th scope="col" class="small text-center vat">{% trans "Recommended intervetion (Hectares)" %}</th>
                                </tr>
                            </thead>
                            <tbody id="idTbodyInterventions"></tbody>
                        </table>
                    </div>
                </div> -->
                <div id="map-step-3" class="container-border">
                    <div id="mapiddecision" style="position: relative;width: 100%;height: 400px; margin-left: 2%; margin-top: 2%;"></div>
                </div>
            </div>

        </div>
</form>
<div class="align-text col-md-12 div-padding visible">
    <div class="list-menu-results" id="idFinancialIndicators">
        <img src="/static/geonode/img/Indicadores-financieros.png" title="{% trans "Financial indicators" %}"/> 
        <br> 
        <a href="../../reports/financial/">{% trans "Financial indicators" %}</a>
    </div>
    <div class="list-menu-results">
        <img src="/static/geonode/img/indicadores-fisicos.png" title="{% trans "Physical indicators" %}"/> 
        <br>
        <!--a>{% trans "Physical indicators" %}</a-->
        <a href="../../reports/physical/{{idx}}">{% trans "Physical indicators" %}</a>
    </div>
    <div class="list-menu-results" id="idDecisionIndicators">
        <img src="/static/geonode/img/indicadores-decision.png" style="opacity: 30%;" title="{% trans "Decision indicators" %}"/>
        <br>
        <a>{% trans "Decision indicators" %}</a>
    </div>
    <div class="list-menu-results" id="idGeographicIndicators">
        <img src="/static/geonode/img/indicadores-geograficos.png" title="{% trans "Geographic visualization" %}"/>
        <br>
        <a href="../../reports/geographic/">{% trans "Geographic visualization" %}</a>
    </div>
</div>

{% endblock %} {% block extra_script %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="https://code.highcharts.com/modules/solid-gauge.js"></script>

<script src="{{ STATIC_URL }}geonode/js/datatables/dataTables.bootstrap.min.js"></script>

<script type="text/javascript" src="{% url 'javascript-catalog-intake' %}"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/smartwizard@5/dist/js/jquery.smartWizard.min.js" type="text/javascript"></script>

<!--ZIP reader library-->
<script src="{{ STATIC_URL }}geonode/js/jszip/jszip.min.js"></script>
<!--Shapefile reader library -->
<script src="{{ STATIC_URL }}geonode/js/shp/shp.min.js"></script>
<script src="{{ STATIC_URL }}geonode/js/proj4js/proj4.js"></script>
<script type="text/javascript">
    var mxBasePath = '{{ STATIC_URL }}geonode/js/mxgraph/src';
    var mxImageBasePath = '{{ STATIC_URL }}geonode/js/mxgraph/examples/images';
    var editorUrl = '{{ STATIC_URL }}geonode/js/mxgraph/examples/editors/config/diagrameditor.xml';
    var serverApi = '{{serverApi}}';
    var lang = '{{LANGUAGE_CODE}}';
    OSM_BASEMAP_URL = '{{ OSM_BASEMAP_URL }} ';
    IMG_BASEMAP_URL = '{{ IMG_BASEMAP_URL }} ';
    HYDRO_BASEMAP_URL = '{{ HYDRO_BASEMAP_URL }} ';
    GRAY_BASEMAP_URL = '{{ GRAY_BASEMAP_URL }} ';
    GEOSERVER_WMS = '{{ GEOSERVER_WMS }}';
    HYDRO_NETWORK_LYR = '{{ HYDRO_NETWORK_LYR }}';
</script>
<script src="{{ STATIC_URL }}geonode/js/mxgraph/mxClient.js"></script>
<script src="{{ STATIC_URL }}geonode/js/mxgraph/examples/editors/js/app.js"></script>
<script src="{{ STATIC_URL }}geonode/js/mxgraph/examples/editors/js/app.js"></script>
<script src="{{ STATIC_URL }}waterproof_intake/mathquill/mathquill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
    var intakePolygons = [];
    SEARCH_CITY_API_URL = '{{ SEARCH_CITY_API_URL }}';
    SEARCH_COUNTRY_API_URL = '{{ SEARCH_COUNTRY_API_URL }}';
</script>


<script>
    var countriesLayerUrl = '{{ STATIC_URL }}waterproof_nbs_ca/data/countries.geojson';
    var userCountryId='{{country.id}}';
    var userCountryCode='{{country.codeCountry}}';
    var userCountryName='{{country.nameCountry}}';
</script>
<script type="text/javascript" src="{% url 'javascript-catalog-treatment' %}"></script>
<script src="{{ STATIC_URL }}geonode/js/datatables/jquery.dataTables.min.js"></script>
<script src="{{ STATIC_URL }}geonode/js/datatables/dataTables.bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/leaflet.ajax.min.js"></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/photon/leaflet.photon.js"></script>
<script src=" {{ STATIC_URL }}geonode/js/leaflet/leaflet-omnivore.min.js "></script>

<script type=" text/javascript ">
    API_URL = '/proxy/?url=https://photon.komoot.de/api/?';
    TILELAYER = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png';
    CENTER = [-74.4879, 4.582];
    MAXZOOM = 11;

    let waterproof = {};

    $(document).ready(function() {
    });

    var searchPoints = L.geoJson(null, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.name);
        }
    });

</script>

<script type="text/javascript">

$("#step3-map")[0].append($("#map-step-3")[0]);

$(function () {

    var IMAGE_LYR_URL = "https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryTopo/MapServer/tile/{z}/{y}/{x}";
    var HYDRO_LYR_URL = "https://tiles.arcgis.com/tiles/P3ePLMYs2RVChkJx/arcgis/rest/services/Esri_Hydro_Reference_Overlay/MapServer/tile/{z}/{y}/{x}";
    var MAXZOOM = 11;
    var TILELAYER = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png';
    var CENTER = [4.582, -74.4879];
    var lyrsPolygons = [];
    var map;
    var table = $('#example').DataTable();
    var searchPoints = L.geoJson(null, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.name);
        }
    });
    var dataTotalBenefitsIntake = [];
    var dataTotalBenefitsIntakeOne = [];

    loadGraphIntahe = function(valueSelect) {
        var listObject = document.getElementsByName("listGraphIntake");
        listObject.forEach((divVisible) => {
            if(valueSelect !== "") {
                divVisible.style.display = "none";
                if(divVisible.getAttribute("nameSelect") === valueSelect) {
                    divVisible.style.display = "block";
                }                
            } else  {
                divVisible.style.display = "block";
            }
        });
    }

    changeReport = function() {
        location.href = "../../study_cases/report/" + localStorage.idStudyCase;
    }

    var localStorageId = localStorage.idStudyCase;
    $('#Return').append(
        `
        <a href="../../study_cases/report/${localStorageId}">{% trans "Return" %}</a>
            
        `
    );

    /**
    * Search the points of a city and load them in the polygon of the map
    * @param {String} Object with the identity of the city    
    * @returns 
    */
    showSearchPoints = function(geojson) {
        searchPoints.clearLayers();
        let geojsonFilter = geojson.features.filter(feature => feature.properties.type == "city");
        searchPoints.addData(geojsonFilter);
        let cityName = geojsonFilter[0].properties.name;
        drawPolygons(cityName);
        table.search(cityName.substr(0, 5)).draw();
    }
    /**
    * Load the results of the city on the map 
    * @param {String} map limit
    * @returns 
    */
    selectedResultHandler = function (feat) {

        waterproof["cityCoords"] = [feat.geometry.coordinates[1], feat.geometry.coordinates[0]];
        localStorage.setItem('cityCoords', JSON.stringify(waterproof["cityCoords"]));


        searchPoints.eachLayer(function(layer) {
            if (layer.feature.properties.osm_id != feat.properties.osm_id) {
                layer.remove();
            }
        });
        let country = feat.properties.country;
        let cityName = feat.properties.name;
        let countryCode = feat.properties.countrycode.toLowerCase();

        $("#countryLabel").html(country);
        $("#cityLabel").html(cityName);
        localStorage.setItem('city', cityName);

        drawPolygons(cityName);
        table.search(cityName.substr(0, 5)).draw();

        let urlAPI = '{{ SEARCH_COUNTRY_API_URL }}' + countryCode;

        $.get(urlAPI, function(data) {
            $("#regionLabel").html(data.region);
            $("#currencyLabel").html(data.currencies[0].name + " - " + data.currencies[0].symbol);
            $("#listIntakes").show();

            localStorage.setItem('country', country);
            localStorage.setItem('region', data.region);
            localStorage.setItem('currency', data.currencies[0].name + " - " + data.currencies[0].symbol);
        });
    }
    /**
    * Draw the polygons on the map when selecting the city 
    * @param {String} city that is registered in the search space    
    * @returns 
    */
    drawPolygons = function(citySearch) {
        lyrsPolygons.forEach(lyr => map.removeLayer(lyr));
        lyrsPolygons = [];
        var bounds;
        intakePolygons.forEach((feature) => {
            if (feature.polygon !== 'None' && feature.polygon != '') {
                let poly = feature.polygon;
                if (poly.indexOf("SRID") >= 0) {
                    poly = poly.split(";")[1];
                }
                var lyrPoly = omnivore.wkt.parse(poly).addTo(map);
                lyrsPolygons.push(lyrPoly);
                if (bounds == undefined) {
                    bounds = lyrPoly.getBounds();
                } else {
                    bounds = bounds.extend(lyrPoly.getBounds());
                }
            }
        });
        if (bounds != undefined) {
            map.fitBounds(bounds);
        }
    };
    initMapDecision = function () {
            map = L.map('mapiddecision', {
                scrollWheelZoom: false,
                zoomControl: false,
                photonControl: true,
                photonControlOptions: {
                    resultsHandler: showSearchPoints,
                    selectedResultHandler: selectedResultHandler,
                    placeholder: 'Search City...',
                    position: 'topleft',
                    url: SEARCH_CITY_API_URL
                }
            });

            let initialCoords = CENTER;
            var cityCoords = localStorage.getItem('cityCoords');
            var city = localStorage.getItem('city');
            var initialZoom = 5;
            var cityNameMap = localStorage.getItem('city').substr(0, 5);

            if (cityCoords == undefined) {
                cityCoords = initialCoords;
            } else {
                initialCoords = JSON.parse(cityCoords);
                drawPolygons(city);
                initialZoom = 9;
                try {
                    $("#countryLabel").html(localStorage.getItem('country'));
                    $("#cityLabel").html(localStorage.getItem('city'));
                    $("#regionLabel").html(localStorage.getItem('region'));
                    $("#currencyLabel").html(localStorage.getItem('currency'));
                    $("#listIntakes").show();
                } catch (e) {

                }
            }

            table.search(cityNameMap).draw();

            map.setView(initialCoords, initialZoom);

            searchPoints.addTo(map);

            var tilelayer = L.tileLayer(TILELAYER, { maxZoom: MAXZOOM, attribution: 'Data \u00a9 <a href="http://www.openstreetmap.org/copyright"> OpenStreetMap Contributors </a> Tiles \u00a9 Komoot' }).addTo(map);
            var images = L.tileLayer(IMAGE_LYR_URL);


            var hydroLyr = L.tileLayer(HYDRO_LYR_URL);

            var baseLayers = {
                OpenStreetMap: tilelayer,
                Images: images,
            };

            var overlays = {
                "Hydro (esri)": hydroLyr,
            };


            var zoomControl = new L.Control.Zoom({ position: 'topright' }).addTo(map);
            L.control.layers(baseLayers, overlays, { position: 'topleft' }).addTo(map);

            function onMapClick(e) {
            }
            map.on('click', onMapClick);
    }

    initMapPhysical = function () {
            map = L.map('mapidphysical', {
                scrollWheelZoom: false,
                zoomControl: false,
                photonControl: true,
                photonControlOptions: {
                    resultsHandler: showSearchPoints,
                    selectedResultHandler: selectedResultHandler,
                    placeholder: 'Search City...',
                    position: 'topleft',
                    url: SEARCH_CITY_API_URL
                }
            });

            let initialCoords = CENTER;
            var cityCoords = localStorage.getItem('cityCoords');
            var city = localStorage.getItem('city');
            var initialZoom = 5;
            var cityNameMap = localStorage.getItem('city').substr(0, 5);

            if (cityCoords == undefined) {
                cityCoords = initialCoords;
            } else {
                initialCoords = JSON.parse(cityCoords);
                drawPolygons(city);
                initialZoom = 9;
                try {
                    $("#countryLabel").html(localStorage.getItem('country'));
                    $("#cityLabel").html(localStorage.getItem('city'));
                    $("#regionLabel").html(localStorage.getItem('region'));
                    $("#currencyLabel").html(localStorage.getItem('currency'));
                    $("#listIntakes").show();
                } catch (e) {

                }
            }

            table.search(cityNameMap).draw();

            map.setView(initialCoords, initialZoom);

            searchPoints.addTo(map);

            var tilelayer = L.tileLayer(TILELAYER, { maxZoom: MAXZOOM, attribution: 'Data \u00a9 <a href="http://www.openstreetmap.org/copyright"> OpenStreetMap Contributors </a> Tiles \u00a9 Komoot' }).addTo(map);
            var images = L.tileLayer(IMAGE_LYR_URL);


            var hydroLyr = L.tileLayer(HYDRO_LYR_URL);

            var baseLayers = {
                OpenStreetMap: tilelayer,
                Images: images,
            };

            var overlays = {
                "Hydro (esri)": hydroLyr,
            };


            var zoomControl = new L.Control.Zoom({ position: 'topright' }).addTo(map);
            L.control.layers(baseLayers, overlays, { position: 'topleft' }).addTo(map);

            function onMapClick(e) {
            }
            map.on('click', onMapClick);
    }

    changeGraphRoiCost = function() {
        Highcharts.chart('containerRoi', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Return of investment'
                },
                colors: ['#fe7700', '#ffc400', '#426ac7', '#a5a5a5'],
                xAxis: {
                    categories: [1,2,3]
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'Total Cost',
                    data: [1,2,3]
                },{
                    name: 'Total Discounted Benefits',
                    type: 'spline',
                    dashStyle: 'shortdot',
                    data: [1,2,3]
                }]
            });
    };

    displayList = function(nameObject, nameTitle) {
        if(document.getElementById(nameObject).style.display === "none") {
            document.getElementById(nameObject).style.display = "block";
            document.getElementById(nameTitle).style.borderWidth = "2px";
        } else {
            document.getElementById(nameObject).style.display = "none";
            document.getElementById(nameTitle).style.borderWidth = "0px";
            changeGraphRoiCost();
        }
    };

    changePie = function (selectName) {
        dataTotalBenefitsIntakeOne = [];
        dataTotalBenefitsIntake.forEach((featureIntake) => {
            if(featureIntake.type ===  selectName) {
                dataTotalBenefitsIntakeOne.push({
                    name: featureIntake.name,
                    y: featureIntake.y
                })
            }
        });

        Highcharts.chart('containerAbi', {
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie'
            },
            title: {
                text: 'Intake Benefits'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: false
                    },
                    showInLegend: true
                }
            },
            credits: {
                enabled: false
            },
            series: [{
                name: 'Intake Benefits',
                colorByPoint: true,
                data: dataTotalBenefitsIntakeOne
            }]
        });
    };

    initialize = function () {

        $("#idCountri").html(localStorage.getItem('country'));
        $("#idCity").html(localStorage.getItem('city'));
        $("#idRegion").html(localStorage.getItem('region'));
        $("#idNameStudyCase").html(localStorage.getItem('studyCasesName'));

        var gaugeOptions = {
            chart: {
                type: 'solidgauge'
            },

            title: null,

            pane: {
                center: ['50%', '85%'],
                size: '140%',
                startAngle: -90,
                endAngle: 90,
                background: {
                    backgroundColor:
                        Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
                    innerRadius: '60%',
                    outerRadius: '100%',
                    shape: 'arc'
                }
            },

            exporting: {
                enabled: false
            },

            tooltip: {
                enabled: false
            },

            yAxis: {
                stops: [
                    [0.1, '#55BF3B'], // green
                    [0.5, '#DDDF0D'], // yellow
                    [0.9, '#DF5353'] // red
                ],
                lineWidth: 0,
                tickWidth: 0,
                minorTickInterval: null,
                tickAmount: 2,
                title: {
                    y: -70
                },
                labels: {
                    y: 16
                }
            },

            plotOptions: {
                solidgauge: {
                    dataLabels: {
                        y: 5,
                        borderWidth: 0,
                        useHTML: true
                    }
                }
            }
        };

        var urlDetail = "../../reports/getReportOportunityResultIndicators/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {

                if (value.description!="TotalTreatmentCostSavings" && value.description!="TimeFrame" && value.description != "TotalEstimatedInvestment" && value.description!="TotalAreaInterventionSize(Hec)"){
                    document.getElementById("idRoi").innerHTML = value.value.toFixed(2);
                    var nameButtom = value.description.split("::");
                    if(nameButtom[1] === "Dark Green") {
                        document.getElementById("idBtnRoi").style.backgroundColor = "#155816";
                    } else if(nameButtom[1] === "Light Green") {
                        document.getElementById("idBtnRoi").style.backgroundColor = "#35b137";
                    } else {
                        document.getElementById("idBtnRoi").style.backgroundColor = "#af0900";
                    }
                    document.getElementById("idBtnRoi").innerHTML = nameButtom[0];
                }    

                if(value.description === "TotalTreatmentCostSavings") {
                    document.getElementById("idTotalTreatmentCostSavings").innerHTML = Intl.NumberFormat('es').format(value.value.toFixed(2));
                }
                if(value.description === "TimeFrame") {
                    document.getElementById("idTimeFrame").innerHTML = value.value.toFixed(2);
                }
                if(value.description === "TotalEstimatedInvestment") {
                    document.getElementById("idTotalEstimatedInvestment").innerHTML = Intl.NumberFormat('es').format(value.value.toFixed(2));
                }
                if(value.description === "TotalAreaInterventionSize(Hec)") {
                    document.getElementById("idTotalAreaInvestmentSize").innerHTML = Intl.NumberFormat('es-US').format(value.value.toFixed(2));
                }
            });
        });

        var dataListBenefitsIntake = [];
        var firstListIntage = "";
        var urlDetail = "../../reports/getWaterproofReportsAnalysisBenefits/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {

            $.each( data, function( key, value ) {
                if(value.typeId !== firstListIntage) {
                    firstListIntage = value.typeId;
                    dataListBenefitsIntake.push(value.typeId);
                    var sel = document.getElementById('idListSelectIntake');
                    var opt = document.createElement('option');
                    opt.appendChild( document.createTextNode(value.typeId) );
                    opt.value = value.typeId; 
                    sel.appendChild(opt); 
                }

                dataTotalBenefitsIntake.push({
                    type: value.typeId,
                    name: value.elementId,
                    y: value.vpnMedBenefit
                })
            });

            dataTotalBenefitsIntake.forEach((featureIntake) => {
                if(featureIntake.type ===  dataListBenefitsIntake[0]) {
                    dataTotalBenefitsIntakeOne.push({
                        name: featureIntake.name,
                        y: featureIntake.y
                    })
                }
            });

            Highcharts.chart('containerAbi', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                colors: ['#008BAB', '#90D3E7', '#004B56', '#61D1C2'],
                title: {
                    text: 'Intake Benefits'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false
                        },
                        showInLegend: true
                    }
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'Intake Benefits',
                    colorByPoint: true,
                    data: dataTotalBenefitsIntakeOne
                }]
            });
        });

        var dataTotalBenefits = [];
        var urlDetail = "../../reports/getReportAnalysisBenefitsFilterSum/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                dataTotalBenefits.push({
                    name: value.typer,
                    y: value.vpnMedBenefitr
                })
            });

            Highcharts.chart('containerAbt', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                colors: ['#008BAB', '#90D3E7', '#004B56', '#61D1C2'],
                title: {
                    text: 'Total Benefits'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false
                        },
                        showInLegend: true
                    }
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'Total Benefits',
                    colorByPoint: true,
                    data: dataTotalBenefits
                }]
            });
        });

        var dataCostActivity = [];
        var urlDetail = "../../reports/getReportCostsAnalysisFilterNbs/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                dataCostActivity.push({
                    name: value.costIdr,
                    y: value.sumFilter
                })
            });

            Highcharts.chart('containerAca', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                title: {
                    text: 'Costs per Activity'
                },
                colors: ['#008BAB', '#90D3E7', '#004B56', '#61D1C2'],
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false
                        },
                        showInLegend: true
                    }
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'Costs per Activity',
                    colorByPoint: true,
                    data: dataCostActivity
                }]
            });
        });

        var dataTotalCost = [];
        var urlDetail = "../../reports/getReportCostsAnalysisFilter/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                dataTotalCost.push({
                    name: value.typer,
                    y: value.sumFilter
                })
            });

            Highcharts.chart('containerAct', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                title: {
                    text: 'Total Costs'
                },
                colors: ['#008BAB', '#90D3E7', '#004B56', '#61D1C2'],
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false
                        },
                        showInLegend: true
                    }
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'Total Costs',
                    colorByPoint: true,
                    data: dataTotalCost
                }]
            });
        });
        
        var dataEfficiency = [];
        var urlDetail = "../../reports/getTotalBenefitsForMilion/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var txtFileEfficiency = '<tr><td class="small text-center vat" >Value</td>';
            $.each( data, function( key, value ) {
                dataEfficiency.push(parseFloat(value.carbonStorage));
                dataEfficiency.push(parseFloat(value.phosphorousLoad));
                dataEfficiency.push(parseFloat(value.nitrogenLoad));
                dataEfficiency.push(parseFloat(value.totalSediments));
                dataEfficiency.push(parseFloat(value.baseFlow));
                dataEfficiency.push(parseFloat(value.waterYear));
                txtFileEfficiency = txtFileEfficiency + '<td class="small text-center vat">' + value.carbonStorage + '</td>';
                txtFileEfficiency = txtFileEfficiency + '<td class="small text-center vat">' + value.phosphorousLoad + '</td>';
                txtFileEfficiency = txtFileEfficiency + '<td class="small text-center vat">' + value.nitrogenLoad + '</td>';
                txtFileEfficiency = txtFileEfficiency + '<td class="small text-center vat">' + value.totalSediments + '</td>';
                txtFileEfficiency = txtFileEfficiency + '<td class="small text-center vat">' + value.baseFlow + '</td>';
                txtFileEfficiency = txtFileEfficiency + '<td class="small text-center vat">' + value.waterYear + '</td>';
            });
            txtFileEfficiency = txtFileEfficiency + '</tr>';
            document.getElementById("idTbodyEfficiency").innerHTML = document.getElementById("idTbodyEfficiency").innerHTML + txtFileEfficiency;

            Highcharts.chart('containerPe', {
                chart: {
                    type: 'bar'
                },
                colors: ['#008BAB'],
                title: {
                    text: 'Portfolio Efficiency'
                },
                xAxis: {
                    categories: ['Carbon storage', 'Phosphorus load', 'Nitrogen load', 'Total sediments', 'Base flow', 'Volumen of water yield']
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'PE',
                    data: dataEfficiency
                }]
            });
        });

        // $('#idSectionIbc').click(function (e) {
        //     $('#idSectionRi').attr('class', 'inform-section inform-section-free');
        //     $('#step5').css("display", "none");

        //     $('#idSectionOr').attr('class', 'inform-section inform-section-free');
        //     $('#step3').css("display", "none");

        //     $('#idSectionPe').attr('class', 'inform-section inform-section-free');
        //     $('#step2').css("display", "none");

        //     $('#idSectionPr').attr('class', 'inform-section inform-section-free');
        //     $('#step4').css("display", "none");

        //     $('#idSectionIbc').attr('class', 'inform-section');
        //     $('#step1').css("display", "block");
        // });
        // $('#idSectionPe').click(function (e) {
        //     $('#idSectionRi').attr('class', 'inform-section inform-section-free');
        //     $('#step5').css("display", "none");

        //     $('#idSectionPr').attr('class', 'inform-section inform-section-free');
        //     $('#step4').css("display", "none");

        //     $('#idSectionOr').attr('class', 'inform-section inform-section-free');
        //     $('#step3').css("display", "none");

        //     $('#idSectionIbc').attr('class', 'inform-section inform-section-free');
        //     $('#step1').css("display", "none");

        //     $('#idSectionPe').attr('class', 'inform-section');
        //     $('#step2').css("display", "block");
        // });
        // $('#idSectionOr').click(function (e) {
        //     $('#idSectionOr').attr('class', 'inform-section');
        //     $('#step3').css("display", "block");
        //     initMapDecision();
        // });
        // $('#idSectionPr').click(function (e) {
        //     $('#idSectionRi').attr('class', 'inform-section inform-section-free');
        //     $('#step5').css("display", "none");

        //     $('#idSectionIbc').attr('class', 'inform-section inform-section-free');
        //     $('#step1').css("display", "none");

        //     $('#idSectionPe').attr('class', 'inform-section inform-section-free');
        //     $('#step2').css("display", "none");

        //     $('#idSectionOr').attr('class', 'inform-section inform-section-free');
        //     $('#step3').css("display", "none");

        //     $('#idSectionPr').attr('class', 'inform-section');
        //     $('#step4').css("display", "block");

        //     initMapPhysical();
        // });
        // $('#idSectionRi').click(function (e) {
        //     $('#idSectionPr').attr('class', 'inform-section inform-section-free');
        //     $('#step4').css("display", "none");

        //     $('#idSectionIbc').attr('class', 'inform-section inform-section-free');
        //     $('#step1').css("display", "none");

        //     $('#idSectionPe').attr('class', 'inform-section inform-section-free');
        //     $('#step2').css("display", "none");

        //     $('#idSectionOr').attr('class', 'inform-section inform-section-free');
        //     $('#step3').css("display", "none");

        //     $('#idSectionRi').attr('class', 'inform-section');
        //     $('#step5').css("display", "block");
        //     initMapPhysical();
        // });

        $('#mapInit').click(function(e){
            initMapDecision();
        });

        document.getElementById("idNumberOfWaterDecision").innerHTML = localStorage.getItem('idNumberOfWater');
        document.getElementById("idNumberOfDrinkingDecision").innerHTML = localStorage.getItem('idNumberOfDrinking');
        document.getElementById("idCurrencyMainDecision").innerHTML = localStorage.getItem('idCurrencyMain');
        document.getElementById("idTimeMainDecision").innerHTML = localStorage.getItem('idTimeMain');
        
        var urlDetail = "../../reports/getDistinctGroupErr/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var listFielTable = "";
            $.each( data, function( key, value ) {
            });
        });

        var urlDetail = "../../reports/getWpAqueductIndicatorGraph/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var lastGroupImage = "";
            var titleGraph = "";
            var numberContainer = 0;
            $.each( data, function( key, value ) {

                if(lastGroupImage !== value.indicator) {
                    if(titleGraph !== "") {
                        titleGraph = titleGraph + '</div>';
                    }
                    titleGraph = titleGraph + '<div name="listGraphIntake" nameSelect="' + value.indicator + '" class="title-water" style="float: left;width: 100%;">' + value.indicator + '</div><div name="listGraphIntake"  nameSelect="' + value.indicator + '" class="container-general-gauge">';
                    lastGroupImage = value.indicator;

                    var option = document.createElement("option");
                    option.text = value.indicator;
                    option.value = value.indicator;
                    document.getElementById("idSelectWaterIntake").add(option);
                }
                titleGraph = titleGraph + '<div class="container-gauge"><div id="containerPr' + numberContainer + '"></div></div>';
                numberContainer++;
            });
            titleGraph = titleGraph + '</div>';
            document.getElementById("idListGraph").innerHTML = titleGraph;


            setTimeout(function(){
                var urlDetail = "../../reports/getWpAqueductIndicatorGraph/?studyCase=" + localStorage.idStudyCase;
                $.getJSON(urlDetail, function (data) {
                    var numberContainerG = 0;
                    $.each( data, function( key, value ) {
                        var chartSpeed = Highcharts.chart('containerPr' + numberContainerG, Highcharts.merge(gaugeOptions, {
                            yAxis: {
                                min: 0,
                                max: 6,
                                stops: [
                                    [0.1, '#90D3E7'],
                                    [0.3, '#61D1C2'],
                                    [0.5, '#008BAB'],
                                    [0.7, '#004B56'],
                                    [0.9, '#01353D']
                                ],
                                title: {
                                    text: value.description
                                }
                            },
                            credits: {
                                enabled: false
                            },
                            series: [{
                                name: 'Baseline water stress',
                                data: [value.valueIndicator],
                                dataLabels: {
                                    format:
                                        '<div style="text-align:center">' +
                                        '<span style="font-size:25px">{y}</span><br/>' +
                                        '</div>'
                                }
                            }]
                        }));
                        numberContainerG++;
                    });
                });
            }, 3000);
        });

        var urlDetail = "../../reports/getReportOportunityResultMaps/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                var jsonPolygon = JSON.parse(value.polygon);
                var stringPolygon = "";
                jsonPolygon.features.forEach((featureCoord) => {
                    featureCoord.geometry.coordinates.forEach((featureCoordList) => {
                        var contList = 0;
                        featureCoordList.forEach((featureCoordListPoint) => {
                            contList++;
                            if(contList === featureCoordList.length) {
                                stringPolygon = stringPolygon + featureCoordListPoint[0] + " " + featureCoordListPoint[1];
                            } else {
                                stringPolygon = stringPolygon + featureCoordListPoint[0] + " " + featureCoordListPoint[1] + ",";
                            }
                        });
                    });
                });
                intakePolygons.push({polygon: "POLYGON ((" + stringPolygon + "))"});
            });
        });

        var urlDetail = "../../reports/getSizeRecomendedIntervention/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                document.getElementById("idSizeRecomend").innerHTML = value.sizeRecomendedIntervention + " % ";
                
            });
        });

        var urlDetail = "../../reports/getNameWaterproofIntakeIntake/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                var sel = document.getElementById('idSelectNameIntake');
                var opt = document.createElement('option');
                opt.appendChild( document.createTextNode(value.name) );
                opt.value = value.typeId; 
                sel.appendChild(opt); 
            });
        });

        var urlDetail = "../../reports/getTotalSizeWaterproofIntakePolygon/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                document.getElementById("idTotalSizeWater").innerHTML = value.totalSize;
            });
        });

        var urlDetail = "../../reports/getWaterproofReportsRiosIpa/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                var txtInterventions = '<tr>';
                txtInterventions = txtInterventions + '<td class="small text-center vat">' + value.sbn + '</td>';
                txtInterventions = txtInterventions + '<td class="small text-center vat">' + value.actualSpent + '</td>';
                txtInterventions = txtInterventions + '<td class="small text-center vat">' + value.areaConvertedHa + '</td>';
                txtInterventions = txtInterventions + '</tr>';
                document.getElementById("idTbodyInterventions").innerHTML = document.getElementById("idTbodyInterventions").innerHTML + txtInterventions;
            });
        });
    };
    initialize();
});
    
</script>

<script type="text/javascript">

   



</script>
{% endblock %}