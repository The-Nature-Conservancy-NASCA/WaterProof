{% extends "menu.html" %} {% load i18n %} {% load static from staticfiles %} {% load bootstrap_tags %} {% block extra_head %}
<link href="https://unpkg.com/smartwizard@5/dist/css/smart_wizard_all.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
<link rel="stylesheet" href="{{ STATIC_URL }}geonode/css/leaflet/Control.Coordinates.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}geonode/css/leaflet/Control.Loader.css" />
<!--
<link rel="stylesheet" href="{{ STATIC_URL }}waterproof_intake/mathquill/mathquill.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}waterproof_intake/css/intake.css" /> 
-->
<link rel="stylesheet" href="{{ STATIC_URL }}waterproof_reports/css/reports.css" />


{% endblock %} {% block body_outer %}
<!--header-->
<script type="text/javascript">
    var SelectedCurrency = "{{SelectedCurrency}}";
</script>
<div class="page-header container-title">
    <h1 class="title-financial">{% trans "Financial Indicators" %}</h1>
</div>
<br>
<!--Begin Form-->
<form id="form" method="POST" action="">
    {% csrf_token %}
    <!--Start smartwizard-->
    <div class="smart-wizard-financial">
        <div class="help-in-report header-desc-fin">
            {% trans "This report summarizes the proportions in investment and benefits that will be achieved by the implementation of the SbN:" %}
        </div>
        <div class="align-menu-header">
            <div class="icons-menu-header">
                <img src="/static/geonode/img/Indicadores-financieros.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black; opacity: 30%;" title="{% trans "Financial indicators" %}"/> 
                <br> 
                <a>{% trans "Financial indicators" %}</a>
            </div>
            <div class="icons-menu-header" id="idFinancialIndicators">
                <img src="/static/geonode/img/indicadores-fisicos.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black; opacity: 30%;" title="{% trans "Physical indicators" %}"/> 
                <br> 
                <a>{% trans "Physical indicators" %}</a>
                <!--<a href="../../reports/physical/">{% trans "Physical indicators" %}</a>-->
            </div>
            <div class="icons-menu-header" id="idDecisionIndicators">
                <img src="/static/geonode/img/indicadores-decision.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Decision indicators" %}"/>
                <br>
                <a href="../../reports/decision/">{% trans "Decision indicators" %}</a>
            </div>
            <div class="icons-menu-header" id="idGeographicIndicators">
                <img src="/static/geonode/img/indicadores-geograficos.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Geographic visualization" %}"/>
                <br>
                <a href="../../reports/geographic/">{% trans "Geographic visualization" %}</a>
            </div>
            <div style="float: left;width: 16%;margin-left: 10%;" id="idGeographicIndicators">
                <img src="/static/geonode/img/reportes-icon.png" style="height: 60%; width: 60%; background-repeat: no-repeat; background-position: 50%; border-radius: 50%; background-size: 100% auto; border-color: black;" title="{% trans "Geographic visualization" %}"/>
                <br>
                <a id="Return"></a>
            </div>
        </div>
    </div>
    <div id="smartwizard" style="position: relative;">
        <div class="border-table-title">
            <div class="title-table" id="idNameStudyCase">{% trans "Study Case" %}</div>
            <div class="detail-table">
                <div class="column-left-table">
                    <div class="file-column-left">
                        <div>{% trans "City:" %}</div>
                        <div class="value-file-column-left" id="idCity">{% trans "-" %}</div>
                    </div>
                    <div class="file-column-left">
                        <div>{% trans "Country:" %}</div>
                        <div class="value-file-column-left" id="idCountri">{% trans "-" %}</div>
                    </div>
                    <div class="file-column-left">
                        <div>{% trans "Region:" %}</div>
                        <div class="value-file-column-left" id="idRegion">{% trans "-" %}</div>
                    </div>
                    <div class="file-column-left">
                        <div>{% trans "Time frame (years):" %}</div>
                        <div class="value-file-column-left" id="idTimeMainFinaltial">{% trans "-" %}</div>
                    </div>
                </div>
                <div class="column-right-table">
                    <div class="file-column-left">
                        <div class="title-file-column-right">{% trans "Number of water intakes that are part of the analysis:" %}</div>
                        <div class="value-file-column-left" id="idNumberOfWaterFinaltial"></div>
                    </div>
                    <div class="file-column-left">
                        <div class="title-file-column-right">{% trans "Number of drinking water treatment plants in the system:" %}</div>
                        <div class="value-file-column-left" id="idNumberOfDrinkingFinaltial"></div>
                    </div>
                    <div class="file-column-left">
                        <div class="title-file-column-right">{% trans "Currency:" %}</div>
                        <div class="value-file-column-left" id="idCurrencyMainFinaltial">{% trans "-" %}</div>
                    </div>
                </div>
            </div>
        </div>
        <!--panel of navigation-->
        <div class="title-inform">
            <div id="idSectionRoi" class="inform-section">{% trans "Return of investment (ROI)" %}</div>
            <div id="idSectionNvp" class="inform-section inform-section-free">{% trans "Net Present Value (NPV)" %}</div>
            <div id="idSectionSA" class="inform-section inform-section-free">{% trans "Sensitivity Analysis" %}</div>
        </div>
        <!--Steps-->
        <div class="margin-report">
            <!--Step 1-->
            <div id="step1">
                <br>
                <p style="padding-left: 3%;">{% trans "Return ROI ind text 1" %}</p>
                <div style="text-align: center;">
                        <div class="content-image" style="margin-right: 5%;">
                            <img src="/static/geonode/img/Indicadores-financieros.png"/>
                        </div>
                        <div class="contain-detail">
                            <div class="first-detail">
                                <div class="content-title-first">
                                    <div class="text-title-first" id="idTitleBenefits" style="border-width: 2px;">{% trans "Benefits" %}</div>
                                </div>
                                <div id="listCheckBenefits" style="overflow-x: hidden;overflow-y: scroll;height: 400px; width: 100%;"></div>
                            </div>

                            <div class="first-detail">
                                <div class="content-title-first">
                                    <div class="text-title-first" id="idTitleCost" style="border-width: 2px;">{% trans "Cost" %}</div>
                                </div>
                                <div id="listCheckCost" style="overflow-x: hidden;overflow-y: scroll;height: 400px; width: 100%;"></div>
                            </div>
                        </div>
                </div>
                
                <br>
                <!--Graph-->
                <div style="width: 100%; padding: 80px;margin-top: 400px;">
                    <div id="containerRoi"></div>
                </div>
                <!--Table-->
                <div style="padding-left: 3%; padding-right: 3%;">
                    <div style="clear:both;" class="table-responsive">
                        <table id="idTableRoi" class="table table-striped table-bordered table-condensed" style=" width:100%">
                            <thead id="idTheadRoi"></thead>
                            <tbody id="idTbodyRoi"></tbody>
                        </table>
                    </div>
                </div>
                
            </div>
            <!--Step 3-->
            <div id="step3"  style="display: none;">
                <br>
                <p style="padding-left: 3%;">{% trans "VPN ind text 1" %}</p>
                <p style="padding-left: 3%;">{% trans "VPN ind text 2" %}</p>
                <div class="image-tab-center">
                        <div class="content-image">
                            <img src="/static/geonode/img/indicadores-fisicos-invest.png" style="width: 80%;margin-top: 25%;" />
                        </div>
                        <div class="contain-detail">
                            <!--Graph-->
                            <div style="width: 60%;position: absolute;left: 40%;">
                                <div id="containerCB"></div>
                            </div>
                        </div>
                </div>                
                <br>
                <div class="image-tab-center">
                        <div class="content-image" style="height: 100%;position: relative; margin-top: -4%;">
                            <div style="width: 100%;position: absolute;bottom: 0px;height: auto;left: auto;margin-left: auto;margin-top: auto;top: auto;" class="table-responsive table-with-resp">
                                <table id="idTableNpv" class="table table-striped table-bordered table-condensed" style=" width:100%">
                                    <thead>
                                        <tr class="info">
                                            <th colspan="2" scope="col" class="small text-center vat">{% trans "Net present value summary" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody id="idTbodyNpv"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="contain-detail">
                            <!--Graph-->
                            <div style="width: 60%;position: absolute;left: 40%;">
                                <div id="containerNpv"></div>
                            </div>
                        </div>
                </div>              
            </div>            <!--Step 3-->
            <div id="step4"  style="display: none;" class="col-md-12 border-step-3">
                <div class="container-step-3 col-md-12">
                    <br>
                    <div class="col-md-12">
                        <p>{% trans "Sensitivity ind text 1" %}</p>
                    </div>
                    <div class="col-md-12" style="width: 100%;">
                        <div id="containerTDB"></div>
                        <br>
                    </div>       
                    <div class="col-md-12" style="width: 100%;">
                        <div style="clear:both;" class="table-responsive">
                            <table id="idTableRoi" class="table table-striped table-bordered table-condensed" style=" width:100%">
                                <thead id="idTheadSensibilityBenefit"></thead>
                                <tbody id="idTbodySensibilityBenefit"></tbody>
                            </table>
                        </div>
                        <br>
                    </div>
                    <div class="col-md-12" style="width: 100%;">
                        <div id="containerTDC"></div>
                        <br>
                    </div>                
                    <div class="col-md-12" style="width: 100%;">
                        <div style="clear:both;" class="table-responsive">
                            <table id="idTableRoi" class="table table-striped table-bordered table-condensed" style=" width:100%">
                                <thead id="idTbodySensibilityCost"></thead>
                                <tbody id="idTbodySensibilityCost"></tbody>
                            </table>
                        </div>
                        <br>
                    </div>    
                    <!--Table-->
                    <div class="col-md-12" style="width: 100%; height: 80%;">
                        <br>
                        <div class="col-md-6">
                            <!--Graph-->
                            <div>
                                <div id="containerRoiS"></div>
                            </div>
                            <div style="font-size: 15px;">{% trans "Sensitivity ind text 3" %}</div>
                        </div>
                                
                        <div class="col-md-6">
                            <!--Graph-->
                            <div>
                                <div id="containerCvB"></div>
                            </div>
                            <div style="font-size: 15px;">{% trans "Sensitivity ind text 2" %}</div>
                        </div>
                        <br>
                    </div>
                    <div class="col-md-12">
                        <br>
                    </div>
                </div>
            </div>
        </div>
</form>

{% endblock %} {% block extra_script %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<script src="{{ STATIC_URL }}geonode/js/datatables/dataTables.bootstrap.min.js"></script>

<script type="text/javascript" src="{% url 'javascript-catalog-intake' %}"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/smartwizard@5/dist/js/jquery.smartWizard.min.js" type="text/javascript"></script>

<!--ZIP reader library-->
<script src="{{ STATIC_URL }}geonode/js/jszip/jszip.min.js"></script>
<!--Shapefile reader library -->
<script src="{{ STATIC_URL }}geonode/js/shp/shp.min.js"></script>
<script src="{{ STATIC_URL }}geonode/js/proj4js/proj4.js"></script>
<script type="text/javascript">
    var mxBasePath = '{{ STATIC_URL }}geonode/js/mxgraph/src';
    var mxImageBasePath = '{{ STATIC_URL }}geonode/js/mxgraph/examples/images';
    var editorUrl = '{{ STATIC_URL }}geonode/js/mxgraph/examples/editors/config/diagrameditor.xml';
    var serverApi = '{{serverApi}}';
    var lang = '{{LANGUAGE_CODE}}';
    let waterproof = {};
    OSM_BASEMAP_URL = '{{ OSM_BASEMAP_URL }} ';
    IMG_BASEMAP_URL = '{{ IMG_BASEMAP_URL }} ';
    HYDRO_BASEMAP_URL = '{{ HYDRO_BASEMAP_URL }} ';
    GRAY_BASEMAP_URL = '{{ GRAY_BASEMAP_URL }} ';
    GEOSERVER_WMS = '{{ GEOSERVER_WMS }}';
    HYDRO_NETWORK_LYR = '{{ HYDRO_NETWORK_LYR }}';
</script>
<!--<script src="{{ STATIC_URL }}waterproof_reports/js/physicalIndicators.js"></script>-->
<script src="{{ STATIC_URL }}geonode/js/mxgraph/mxClient.js"></script>
<script src="{{ STATIC_URL }}geonode/js/mxgraph/examples/editors/js/app.js"></script>
<script src="{{ STATIC_URL }}geonode/js/mxgraph/examples/editors/js/app.js"></script>
<script src="{{ STATIC_URL }}waterproof_intake/mathquill/mathquill.min.js"></script>
<!--<script src="{{ STATIC_URL }}waterproof_reports/js/physicalIndicators.js"></script>-->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script type="text/javascript">

$(function () {

    var totalBenefits= [];
    var categories = [];
    var totalCost = [];
    var totalDiscountedCost = [];
    var totalDiscountedBenefits = [];

    changeReport = function() {
        location.href = "../../study_cases/report/" + localStorage.idStudyCase;
    }

    var localStorageId = localStorage.idStudyCase;
    $('#Return').append(
        `
        <a href="../../study_cases/report/${localStorageId}">{% trans "Return" %}</a>
            
        `
    );

    displayList = function(nameObject, nameTitle) {
        if(document.getElementById(nameObject).style.display === "none") {
            document.getElementById(nameObject).style.display = "block";
            document.getElementById(nameTitle).style.borderWidth = "2px";
        } else {
            document.getElementById(nameObject).style.display = "none";
            document.getElementById(nameTitle).style.borderWidth = "0px";
            changeGraphRoiCost();
        }
    };

    loadDetailFilter = function(object, name){
        if(object.checked) {
            var listObject = document.getElementsByName(name);
            listObject.forEach( function(valor, indice) {
                for (var countBenefits = 0; countBenefits < totalBenefits.length; countBenefits++) {
                    totalBenefits[countBenefits] = parseFloat((totalBenefits[countBenefits] + parseFloat(valor.value)).toFixed(2));
                }
            });
            var listObject = document.getElementsByName('dis' + name);
            listObject.forEach( function(valor, indice) {
                for (var countBenefits = 0; countBenefits < totalDiscountedBenefits.length; countBenefits++) {
                    totalDiscountedBenefits[countBenefits] = parseFloat((totalDiscountedBenefits[countBenefits] + parseFloat(valor.value)).toFixed(2));
                }
            });
        } else {
            var listObject = document.getElementsByName(name);
            listObject.forEach( function(valor, indice) {
                for (var countBenefits = 0; countBenefits < totalBenefits.length; countBenefits++) {
                    totalBenefits[countBenefits] = parseFloat((totalBenefits[countBenefits] - parseFloat(valor.value)).toFixed(2));
                }
            });
            var listObject = document.getElementsByName('dis' + name);
            listObject.forEach( function(valor, indice) {
                for (var countBenefits = 0; countBenefits < totalDiscountedBenefits.length; countBenefits++) {
                    totalDiscountedBenefits[countBenefits] = parseFloat((totalDiscountedBenefits[countBenefits] - parseFloat(valor.value)).toFixed(2));
                }
            });
        }
        setTimeout(function(){
            Highcharts.chart('containerRoi', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Cost and benefits'
                },
                colors: ['#008BAB', '#90D3E7', '#004B56', '#61D1C2'],
                xAxis: {
                    categories: categories
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'Total Cost',
                    data: totalCost
                },{
                    name: 'Total Discounted Cost',
                    data: totalDiscountedCost
                },{
                    name: 'Total Benefits',
                    type: 'spline',
                    dashStyle: 'shortdot',
                    data: totalBenefits
                },{
                    name: 'Total Discounted Benefits',
                    type: 'spline',
                    dashStyle: 'shortdot',
                    data: totalDiscountedBenefits
                }]
            });
        }, 1000);
    }

    loadDetailFilterCost = function(object, name){
        if(object.checked) {
            var listObject = document.getElementsByName('cost' + name);
            listObject.forEach( function(valor, indice) {
                for (var countCost = 0; countCost < totalCost.length; countCost++) {
                    totalCost[countCost] = parseFloat((totalCost[countCost] + parseFloat(valor.value)).toFixed(2));
                }
            });
            var listObject = document.getElementsByName('costDis' + name);
            listObject.forEach( function(valor, indice) {
                for (var countCost = 0; countCost < totalDiscountedCost.length; countCost++) {
                    totalDiscountedCost[countCost] = parseFloat((totalDiscountedCost[countCost] + parseFloat(valor.value)).toFixed(2));
                }
            });
        } else {
            var listObject = document.getElementsByName('cost' + name);
            listObject.forEach( function(valor, indice) {
                for (var countCost = 0; countCost < totalCost.length; countCost++) {
                    totalCost[countCost] = parseFloat((totalCost[countCost] - parseFloat(valor.value)).toFixed(2));
                }
            });
            var listObject = document.getElementsByName('costDis' + name);
            listObject.forEach( function(valor, indice) {
                for (var countCost = 0; countCost < totalDiscountedCost.length; countCost++) {
                    totalDiscountedCost[countCost] = parseFloat((totalDiscountedCost[countCost] - parseFloat(valor.value)).toFixed(2));
                }
            });
        }

        setTimeout(function(){
            Highcharts.chart('containerRoi', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Return of investment'
                },
                colors: ['#008BAB', '#90D3E7', '#004B56', '#61D1C2'],
                xAxis: {
                    categories: categories
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'Total Cost',
                    data: totalCost
                },{
                    name: 'Total Discounted Cost',
                    data: totalDiscountedCost
                },{
                    name: 'Total Benefits',
                    type: 'spline',
                    dashStyle: 'shortdot',
                    data: totalBenefits
                },{
                    name: 'Total Discounted Benefits',
                    type: 'spline',
                    dashStyle: 'shortdot',
                    data: totalDiscountedBenefits
                }]
            });
        }, 1000);
    }

    initialize = function () {

        $("#idCountri").html(localStorage.getItem('country'));
        $("#idCity").html(localStorage.getItem('city'));
        $("#idRegion").html(localStorage.getItem('region'));
        $("#idNameStudyCase").html(localStorage.getItem('studyCasesName'));

        var htmlBenefitsFilter = "";
        var urlDetail = "../../reports/getReportAnalysisBenefitsFilter/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var lastName = "";
            var lastSubCategory = "";
            $.each( data, function( key, value ) {
                if(value.subCategory ===  null) {
                    value.subCategory = value.name;
                }
                if(lastName !== value.name) {
                    htmlBenefitsFilter = htmlBenefitsFilter + '<div class="first-detail-in"><div class="text-first-detail">' + value.name + '</div></div>';
                    lastName = value.name;
                }
                if(lastSubCategory !== value.subCategory) {
                    htmlBenefitsFilter = htmlBenefitsFilter + '<div class="content-option-first-detail"><div class="div-option"><input type="checkbox" checked onclick="loadDetailFilter(this, \'' + value.subCategory + '\')"></div><div class="div-text">' + value.subCategory + '</div></div>';
                    lastSubCategory = value.subCategory;
                }
                htmlBenefitsFilter = htmlBenefitsFilter + '<input style="display:none" name="' + value.subCategory + '" idPipeLine="' + value.subName + '" value="' + value.totalBenefits + '">';
                htmlBenefitsFilter = htmlBenefitsFilter + '<input style="display:none" name="dis' + value.subCategory + '" idPipeLine="' + value.subName + '" value="' + value.totalBenefitsDiscount + '">';
            });
            document.getElementById("listCheckBenefits").innerHTML = htmlBenefitsFilter;
        });

        var htmlCostFilter = "";
        var urlDetail = "../../reports/getReportCostsAnalysisFilterOne/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var lastName = "";
            var lastSubName = "";
            $.each( data, function( key, value ) {
                if(value.subCategory ===  null) {
                    value.subCategory = value.name;
                }
                if(lastName !== value.name) {
                    htmlCostFilter = htmlCostFilter + '<div class="first-detail-in"><div class="text-first-detail">' + value.name + '</div></div>';
                    lastName = value.name;
                }
                if(lastSubName !== value.subName) {
                    htmlCostFilter = htmlCostFilter + '<div class="content-option-first-detail"><div class="div-option"><input type="checkbox" checked onclick="loadDetailFilterCost(this, \'' + value.name + value.subName + '\')"></div><div class="div-text">' + value.subName + '</div></div>';
                    lastSubName = value.subName;
                }
                htmlCostFilter = htmlCostFilter + '<input style="display:none" name="cost' + value.name + value.subName + '" idPipeLine="' + value.subName + '" value="' + value.totalCost + '">';
                htmlCostFilter = htmlCostFilter + '<input style="display:none" name="costDis' + value.name +value.subName + '" idPipeLine="' + value.subName + '" value="' + value.totalDiscountedCost + '">';


            });
            document.getElementById("listCheckCost").innerHTML = htmlCostFilter;
        });

        var htmlCost = '<tr><td class="small text-center vat" >Total cost</td>';
        var htmlDiscountedCost = '<tr><td class="small text-center vat" >Total discounted cost</td>';
        var htmlBenefits= '<tr><td class="small text-center vat" >total benefits</td>';
        var htmlDiscountedBenefits = '<tr><td class="small text-center vat" >total discounted benefits</td>';
        var htmlTitle = '<tr class="info"><th scope="col" class="small text-center vat">{% trans "Time Period" %}</th>';
        var contTitle = 1;

        var urlDetail = "../../reports/getReportCostsAnalysisRoi/?studyCase=" + localStorage.idStudyCase;

        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                categories.push(value.record);
                totalCost.push(parseFloat(value.totalCost.toFixed(2)));
                totalDiscountedCost.push(parseFloat(value.totalDiscountedCost.toFixed(2)));
                totalBenefits.push(parseFloat(value.totalBenefits.toFixed(2)));
                totalDiscountedBenefits.push(parseFloat(value.totalDiscountedBenefits.toFixed(2)));
                valHtmlCost = value.totalCost.toFixed(2);
                htmlCost = htmlCost + '<td class="small text-center vat" id="valor2">' + Intl.NumberFormat('es').format(valHtmlCost) + '</td>';
                valhtmlDiscountedCost = value.totalDiscountedCost.toFixed(2);
                htmlDiscountedCost = htmlDiscountedCost + '<td class="small text-center vat" id="valor3">' + Intl.NumberFormat('es').format(valhtmlDiscountedCost) + '</td>';
                valhtmlBenefits = value.totalBenefits.toFixed(2);
                htmlBenefits = htmlBenefits + '<td class="small text-center vat" id="valor3">' + Intl.NumberFormat('es').format(valhtmlBenefits) + '</td>';
                valhtmlDiscountedBenefits = value.totalDiscountedBenefits.toFixed(2);
                htmlDiscountedBenefits = htmlDiscountedBenefits + '<td class="small text-center vat" id="valor3">' + Intl.NumberFormat('es').format(valhtmlDiscountedBenefits) + '</td>';
                htmlTitle = htmlTitle + '<th scope="col" class="small text-center vat">{% trans "' + contTitle + '" %}</th>'; 
                contTitle ++;
            });
            htmlCost = htmlCost + '</tr>';
            htmlDiscountedCost = htmlDiscountedCost + '</tr>';
            htmlBenefits = htmlBenefits + '</tr>';
            htmlDiscountedBenefits = htmlDiscountedBenefits + '</tr>';
            htmlTitle = htmlTitle + '</tr>';

            document.getElementById("idTbodyRoi").innerHTML = htmlCost +  htmlDiscountedCost + htmlBenefits + htmlDiscountedBenefits;
            document.getElementById("idTheadRoi").innerHTML = htmlTitle;

            Highcharts.chart('containerRoi', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Cost and benefits'
                },
                colors: ['#008BAB', '#90D3E7', '#004B56', '#61D1C2'],
                xAxis: {
                    categories: categories
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'Total Cost',
                    data: totalCost
                },{
                    name: 'Total Discounted Cost',
                    data: totalDiscountedCost
                },{
                    name: 'Total Benefits',
                    type: 'spline',
                    dashStyle: 'shortdot',
                    data: totalBenefits
                },{
                    name: 'Total Discounted Benefits',
                    type: 'spline',
                    dashStyle: 'shortdot',
                    data: totalDiscountedBenefits
                }]
            });
        });

        var dataCost = [];
        var dataBenefit = [];
        var urlDetail = "../../reports/getCostAndBenefit/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var txtFileNet = "";
            $.each( data, function( key, value ) {
                dataCost.push(parseFloat(value.costr.toFixed(2)));
                dataBenefit.push(parseFloat(value.benefift.toFixed(2)));
            });
            Highcharts.chart('containerCB', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Cost and Benefits'
                },
                colors: ['#008BAB', '#90D3E7'],
                xAxis: {
                    categories: ['Cost and Benefits']
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'Cost',
                    data: dataCost
                },{
                    name: 'Benefits',
                    data: dataBenefit
                }]
            });
        });

        var dataNetPresentValueSummary = [];
        var urlDetail = "../../reports/getNetPresentValueSummary/?studyCase=" + localStorage.idStudyCase;
        var typeMoney = "";
        $.getJSON(urlDetail, function (data) {
            var txtFileNet = "";
            $.each( data, function( key, value ) {
                typeMoney = value.currencyr;
                dataNetPresentValueSummary.push(parseFloat(value.implementationr.toFixed(2)));
                dataNetPresentValueSummary.push(parseFloat(value.maintenancer.toFixed(2)));
                dataNetPresentValueSummary.push(parseFloat(value.oportunityr.toFixed(2)));
                dataNetPresentValueSummary.push(parseFloat(value.transactionr.toFixed(2)));
                dataNetPresentValueSummary.push(parseFloat(value.platformr.toFixed(2)));
                dataNetPresentValueSummary.push(parseFloat(value.benefitr.toFixed(2)));
                dataNetPresentValueSummary.push(parseFloat(value.totalr.toFixed(2)));
                valimplementationr = value.implementationr.toFixed(2);
                valmaintenancer = value.maintenancer.toFixed(2);
                valoportunityr = value.oportunityr.toFixed(2);
                valtransactionr = value.transactionr.toFixed(2);
                valplatformr = value.platformr.toFixed(2);
                valbenefitr = value.benefitr.toFixed(2);
                valtotalr = value.totalr.toFixed(2);
                txtFileNet = txtFileNet + '<tr><td class="small text-left vat" >Cost: implementation</td><td class="small text-right vat">' + Intl.NumberFormat('es').format(valimplementationr) + '</td></tr>';
                txtFileNet = txtFileNet + '<tr><td class="small text-left vat" >Cost: maintenance</td><td class="small text-right vat">' + Intl.NumberFormat('es').format(valmaintenancer) + '</td></tr>';
                txtFileNet = txtFileNet + '<tr><td class="small text-left vat" >Cost: oportunity</td><td class="small text-right vat">' + Intl.NumberFormat('es').format(valoportunityr) + '</td></tr>';
                txtFileNet = txtFileNet + '<tr><td class="small text-left vat" >Cost: transaction</td><td class="small text-right vat">' + Intl.NumberFormat('es').format(valtransactionr) + '</td></tr>';
                txtFileNet = txtFileNet + '<tr><td class="small text-left vat" >Cost: platform</td><td class="small text-right vat">' + Intl.NumberFormat('es').format(valplatformr) + '</td></tr>';
                txtFileNet = txtFileNet + '<tr><td class="small text-left vat" >Benefit</td><td class="small text-right vat">' + Intl.NumberFormat('es').format(valbenefitr) + '</td></tr>';
                txtFileNet = txtFileNet + '<tr><td class="small text-left vat" >Total</td><td class="small text-right vat">' + Intl.NumberFormat('es').format(valtotalr) + '</td></tr>';
            });
            document.getElementById("idTbodyNpv").innerHTML = document.getElementById("idTbodyNpv").innerHTML + txtFileNet;

            Highcharts.chart('containerNpv', {
                chart: {
                    type: 'column'
                },
                colors: ['#008BAB'],
                title: {
                    text: 'Net present value summary'
                },
                xAxis: {
                    categories: ['Implementation', 'Maintance', 'Oportunity', 'Transaction', 'Platform', 'Benefit', 'Total']
                },
                credits: {
                    enabled: false
                },
                series: [{
                    name: 'NPV (' + typeMoney + ')',
                    data: dataNetPresentValueSummary
                }]
            });
        });

        var dataSensibilityAnalysisBenefitsTime = [];
        var dataSensibilityAnalysisBenefitsRange = [];
        var urlDetail = "../../reports/getSensibilityAnalysisBenefits/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            var txtFileBenefitsMinBen = '<tr><td class="small text-center vat" style="text-align: left;">Discounted benefit minimum</td>';
            var txtFileBenefitsMedBen = '<tr><td class="small text-center vat" style="text-align: left;">Discounted benefit Medium</td>';
            var txtFileBenefitsMaxBen = '<tr><td class="small text-center vat" style="text-align: left;">Discounted benefit maximum</td>';
            var txtTitleBenefits = '<tr class="info"><th scope="col" class="small text-center vat">{% trans "Total discounted benefit" %}</th>';
            var contTitleBenefits = 1;
            $.each( data, function( key, value ) {
                dataSensibilityAnalysisBenefitsTime.push([value.timer, Math.round(value.totalMedBenefitR)]);
                dataSensibilityAnalysisBenefitsRange.push([value.timer, Math.round(value.totalMinBenefitR), Math.round(value.totalMaxBenefittR)]);
                valtotalMinBenefitR = parseFloat(value.totalMinBenefitR).toFixed(2);
                valtotalMedBenefitR = parseFloat(value.totalMedBenefitR).toFixed(2);
                valtotalMaxBenefittR = parseFloat(value.totalMaxBenefittR).toFixed(2);
                txtFileBenefitsMinBen = txtFileBenefitsMinBen + '<td class="small text-center vat" style="text-align: right;" id="valor' + value.timer + '">' + Intl.NumberFormat('es').format(valtotalMinBenefitR) + '</td>';
                txtFileBenefitsMedBen = txtFileBenefitsMedBen + '<td class="small text-center vat" style="text-align: right;" id="valor' + value.timer + '">' + Intl.NumberFormat('es').format(valtotalMedBenefitR) + '</td>';
                txtFileBenefitsMaxBen = txtFileBenefitsMaxBen + '<td class="small text-center vat" style="text-align: right;" id="valor' + value.timer + '">' + Intl.NumberFormat('es').format(valtotalMaxBenefittR) + '</td>';
                txtTitleBenefits = txtTitleBenefits + '<th scope="col" class="small text-center vat">{% trans "' + contTitleBenefits + '" %}</th>';
                contTitleBenefits ++;
            });
            txtFileBenefitsMinBen = txtFileBenefitsMinBen + '</tr>';
            txtFileBenefitsMedBen = txtFileBenefitsMedBen + '</tr>';
            txtFileBenefitsMaxBen = txtFileBenefitsMaxBen + '</tr>';
            txtTitleBenefits = txtTitleBenefits + '</tr>';

            document.getElementById("idTheadSensibilityBenefit").innerHTML = txtTitleBenefits;
            document.getElementById("idTbodySensibilityBenefit").innerHTML = document.getElementById("idTbodySensibilityBenefit").innerHTML + txtFileBenefitsMinBen;
            document.getElementById("idTbodySensibilityBenefit").innerHTML = document.getElementById("idTbodySensibilityBenefit").innerHTML + txtFileBenefitsMedBen;
            document.getElementById("idTbodySensibilityBenefit").innerHTML = document.getElementById("idTbodySensibilityBenefit").innerHTML + txtFileBenefitsMaxBen;

            Highcharts.chart('containerTDB', {
                title: {
                    text: 'Sensitivity analysis - total discounted benefit (TDB)'
                },
                credits: {
                    enabled: false
                },
                yAxis: {
                    title: {
                        text: 'Total descounted benefits'
                    }
                },
                xAxis: {
                    title: {
                        text: 'Time in years descoyunted benefits'
                    }
                },
                colors: ['#008BAB'],
                series: [{
                    name: 'TDB',
                    color: "#4c99d8",
                    data: dataSensibilityAnalysisBenefitsTime
                }, {
                    name: 'Range',
                    data: dataSensibilityAnalysisBenefitsRange,
                    type: 'arearange',
                    lineWidth: 0,
                    linkedTo: ':previous',
                    color: "#90D3E7",
                    fillOpacity: 0.3,
                    zIndex: 0,
                    marker: {
                        enabled: false
                    }
                }]
            });
        });

        var dataSensibilityAnalysisCostTime = [];
        var dataSensibilityAnalysisCostRange = [];
        var urlDetail = "../../reports/getSensibilityAnalysisCost/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
//#endregion            var txtFileCost = '<tr><td class="small text-center vat" >Discounted Cost</td>';
            var txtFileCostMinCost = '<tr><td class="small text-center vat" style="text-align: left;">Discounted cost minimum</td>';
            var txtFileCostMedCost = '<tr><td class="small text-center vat" style="text-align: left;">Discounted cost medium</td>';
            var txtFileCostMaxCost = '<tr><td class="small text-center vat" style="text-align: left;">Discounted cost maximum</td>';
            var txtTitleCost = '<tr class="info"><th scope="col" class="small text-center vat">{% trans "Total discounted cost" %}</th>';
            var contTitlecost = 1;

            $.each( data, function( key, value ) {
                dataSensibilityAnalysisCostTime.push([value.timer, Math.round(value.totalMedCostR)]);
                dataSensibilityAnalysisCostRange.push([value.timer, Math.round(value.totalMinCostR), Math.round(value.totalMaxCostR)]);
                valtotalMinCostR = parseFloat(value.totalMinCostR).toFixed(2);
                valtotalMedCostR = parseFloat(value.totalMedCostR).toFixed(2);
                valtotalMaxCostR = parseFloat(value.totalMaxCostR).toFixed(2);
                txtFileCostMinCost = txtFileCostMinCost + '<td class="small text-center vat" style="text-align: right;" id="valor' + value.timer + '">' + Intl.NumberFormat('es').format(valtotalMinCostR) + '</td>';
                txtFileCostMedCost = txtFileCostMedCost + '<td class="small text-center vat" style="text-align: right;" id="valor' + value.timer + '">' + Intl.NumberFormat('es').format(valtotalMedCostR) + '</td>';
                txtFileCostMaxCost = txtFileCostMaxCost + '<td class="small text-center vat" style="text-align: right;" id="valor' + value.timer + '">' + Intl.NumberFormat('es').format(valtotalMaxCostR) + '</td>';
                txtTitleCost = txtTitleCost + '<th scope="col" class="small text-center vat">{% trans "' + contTitlecost + '" %}</th>';
                contTitlecost ++;               
            });
            txtFileCostMinCost = txtFileCostMinCost + '</tr>';
            txtFileCostMedCost = txtFileCostMedCost + '</tr>';
            txtFileCostMaxCost = txtFileCostMaxCost + '</tr>';
            txtTitleCost = txtTitleCost + '</tr>';

            document.getElementById("idTbodySensibilityCost").innerHTML = txtTitleCost;
            document.getElementById("idTbodySensibilityCost").innerHTML = document.getElementById("idTbodySensibilityCost").innerHTML + txtFileCostMinCost;
            document.getElementById("idTbodySensibilityCost").innerHTML = document.getElementById("idTbodySensibilityCost").innerHTML + txtFileCostMedCost;
            document.getElementById("idTbodySensibilityCost").innerHTML = document.getElementById("idTbodySensibilityCost").innerHTML + txtFileCostMaxCost;


            Highcharts.chart('containerTDC', {
                title: {
                    text: 'Sensitivity analysis - total discounted cost (TDC)'
                },
                credits: {
                    enabled: false
                },
                yAxis: {
                    title: {
                        text: 'Total descounted costs'
                    }
                },
                xAxis: {
                    title: {
                        text: 'Time in years descounted benefits'
                    }
                },
                colors: ['#008BAB'],
                series: [{
                    name: 'TDC',
                    color: "#006bc3",
                    data: dataSensibilityAnalysisCostTime,
                    marker: {
                        fillColor: "#a5a5a5",
                        lineColor: "#006bc3"
                    }
                }, {
                    name: 'Range',
                    data: dataSensibilityAnalysisCostRange,
                    type: 'arearange',
                    lineWidth: 0,
                    linkedTo: ':previous',
                    color: "#90D3E7",
                    fillOpacity: 0.3,
                    zIndex: 0,
                    marker: {
                        enabled: false
                    }
                }]
            });
        });

        var serieCvB = []
        var urlDetail = "../../reports/getSensibilityAnalysisCostVsBenefit/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                serieCvB.push({ 
                    name: value.titleR,
                    data: [Math.round(value.totalMinimumR), Math.round(value.totalMediumR), Math.round(value.totalMaximumR)],
                    pointPlacement: 'on'
                });
            });
            Highcharts.chart('containerCvB', {
                chart: {
                    polar: true,
                    type: 'line'
                },
                colors: ['#008BAB'],
                title: {
                    text: 'Costs and benefits sensitivity',
                    x: -80
                },
                xAxis: {
                    categories: ['Minimun discount rate', 'Maximun discount rate', 'Discount rate'],
                    tickmarkPlacement: 'on',
                    lineWidth: 0
                },
                yAxis: {
                    gridLineInterpolation: 'polygon',
                    lineWidth: 0,
                    min: 0
                },
                credits: {
                    enabled: false
                },
                series: serieCvB
            });
        });

        var serieDataRoi = []
        var urlDetail = "../../reports/getSensibilityAnalysisReturnOfInvest/?studyCase=" + localStorage.idStudyCase;
        $.getJSON(urlDetail, function (data) {
            $.each( data, function( key, value ) {
                serieDataRoi.push([parseFloat(value.roiMaximumR), parseFloat(value.roiMinimumR), parseFloat(value.roiMediumR)]);
            });
            Highcharts.chart('containerRoiS', {
                chart: {
                    polar: true,
                    type: 'line'
                },
                colors: ['#008BAB'],
                title: {
                    text: 'ROI sensitivity',
                    x: -80
                },
                xAxis: {
                    categories: ['Minimun discount rate', 'Maximun discount rate', 'Discount rate'],
                    tickmarkPlacement: 'on',
                    lineWidth: 0
                },
                yAxis: {
                    gridLineInterpolation: 'polygon',
                    lineWidth: 0,
                    min: 0
                },
                credits: {
                    enabled: false
                },
                series: [{ 
                    name: 'ROI',
                    data: [3.98, 2.77, 3.39],
                    pointPlacement: 'on'
                }]
            });
        });

        $('#idSectionRoi').click(function (e) {
            $('#idSectionSA').attr('class', 'inform-section inform-section-free');
            $('#step4').css("display", "none");

            $('#idSectionNvp').attr('class', 'inform-section inform-section-free');
            $('#step3').css("display", "none");

            $('#idSectionRoi').attr('class', 'inform-section');
            $('#step1').css("display", "block");
        });
        $('#idSectionNvp').click(function (e) {
            $('#idSectionSA').attr('class', 'inform-section inform-section-free');
            $('#step4').css("display", "none");

            $('#idSectionRoi').attr('class', 'inform-section inform-section-free');
            $('#step1').css("display", "none");

            $('#idSectionNvp').attr('class', 'inform-section');
            $('#step3').css("display", "block");
        });
        $('#idSectionSA').click(function (e) {
            $('#idSectionRoi').attr('class', 'inform-section inform-section-free');
            $('#step1').css("display", "none");

            $('#idSectionNvp').attr('class', 'inform-section inform-section-free');
            $('#step3').css("display", "none");

            $('#idSectionSA').attr('class', 'inform-section');
            $('#step4').css("display", "block");
        });

        document.getElementById("idNumberOfWaterFinaltial").innerHTML = localStorage.getItem('idNumberOfWater');
        document.getElementById("idNumberOfDrinkingFinaltial").innerHTML = localStorage.getItem('idNumberOfDrinking');
        document.getElementById("idCurrencyMainFinaltial").innerHTML = localStorage.getItem('idCurrencyMain');
        document.getElementById("idTimeMainFinaltial").innerHTML = localStorage.getItem('idTimeMain');
    };
    initialize();
});
    
</script>

<script type="text/javascript">

   



</script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/1000hz-bootstrap-validator/0.11.9/validator.min.js"
    integrity="sha512-dTu0vJs5ndrd3kPwnYixvOCsvef5SGYW/zSSK4bcjRBcZHzqThq7pt7PmCv55yb8iBvni0TSeIDV8RYKjZL36A=="
    crossorigin="anonymous"></script>-->
{% endblock %}